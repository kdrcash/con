<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro-Consulting Lab (HTML/JS)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for fixed table headers in a single file */
        .sticky-col-1 {
            left: 0;
            z-index: 20; /* Higher than normal sticky */
            box-shadow: 2px 0 5px -2px rgba(0, 0, 0, 0.1);
        }
        .sticky-col-2 {
            left: 40px; /* Adjust based on col 1 width */
            z-index: 20;
            box-shadow: 2px 0 5px -2px rgba(0, 0, 0, 0.1);
        }
        .table-container {
            overflow-x: auto;
        }
        
        /* Apply sticky class to all relevant cells */
        .sticky-col {
            position: sticky;
        }
    </style>
    <script>
        // --- Tax Calculation Helper ---
        const calculateSimulatedIncomeTax = (taxableIncome) => {
            const tb = Math.max(0, Math.floor(taxableIncome));
            let tax = 0;
            
            if (tb <= 14_000_000)      { tax = tb * 0.06; }
            else if (tb <= 50_000_000) { tax = tb * 0.15 - 1_260_000; }
            else if (tb <= 88_000_000) { tax = tb * 0.24 - 5_760_000; }
            else if (tb <= 150_000_000){ tax = tb * 0.35 - 15_440_000; }
            else if (tb <= 300_000_000){ tax = tb * 0.38 - 19_940_000; }
            else if (tb <= 500_000_000){ tax = tb * 0.40 - 25_940_000; }
            else if (tb <= 1_000_000_000){ tax = tb * 0.42 - 35_940_000; }
            else { tax = tb * 0.45 - 65_940_000; }
            
            return Math.max(0, Math.floor(tax)); 
        };

        // --- Core Calculation Logic ---
        const calculateResults = (inputs, mode) => {
            let { annualRevenue, monthlyExpense, monthlyRequiredExpense, targetProfitRate, afterTaxNetIncome } = inputs;
            
            const annualExp = monthlyExpense * 12; // ì—°ê°„ ê³ ì • ì§€ì¶œ (ì›”ì§€ì¶œ * 12)
            const annualReqExpInput = monthlyRequiredExpense * 12; // ì—°ê°„ í•„ìš” ê²½ë¹„ (ì…ë ¥)

            let calculatedAnnualRevenue = annualRevenue;
            let calculatedMonthlyRequiredExpense = monthlyRequiredExpense;
            let calculatedTargetProfitRate = targetProfitRate;
            
            // DUMMY_TAX_RATEëŠ” Mode 3, 5ì˜ ì—­ì‚° ê³¼ì •ì— ì‚¬ìš©ë¨
            const DUMMY_TAX_RATE = 0.15; 
            
            let actualNetIncome = 0; // ì‹¤ì œ ìˆœì´ìµ (ì—°ë§¤ì¶œ - ì›”ì§€ì¶œ*12)
            let taxBaseIncome = 0; // ëª©í‘œ ìˆœì´ìµ (ì‹¤ì œ ìˆœì´ìµ - ì›”í•„ìš”ê²½ë¹„*12), ê³¼ì„¸í‘œì¤€ìœ¼ë¡œ ì‚¬ìš©

            switch (mode) {
                // Mode 1: ì…ë ¥(ME, MRE, TPR), ì¶œë ¥(AR, MTNI)
                case 'mode1':
                    const totalExpenseInput = annualExp + annualReqExpInput; // ì´ ì—°ê°„ ê²½ë¹„ (ê³ ì •+í•„ìš”)
                    const profitRatioComplement = (1 - targetProfitRate / 100);

                    // 1. AR = ì´ ê²½ë¹„ / (1 - ëª©í‘œì†Œë“ë¥ )
                    if (profitRatioComplement > 0 && targetProfitRate < 100) {
                        calculatedAnnualRevenue = totalExpenseInput / profitRatioComplement;
                    } else {
                        calculatedAnnualRevenue = 0;
                    }
                    
                    // 2. ì‹¤ì œ ìˆœì´ìµ (ANI) = AR - ì›”ì§€ì¶œ*12
                    actualNetIncome = calculatedAnnualRevenue - annualExp;
                    
                    // 3. ê³¼ì„¸í‘œì¤€ (TNI) = ANI - ì›”í•„ìš”ê²½ë¹„*12
                    taxBaseIncome = actualNetIncome - annualReqExpInput;
                    
                    calculatedMonthlyRequiredExpense = monthlyRequiredExpense;
                    calculatedTargetProfitRate = targetProfitRate;
                    break;
                    
                // Mode 2: ì…ë ¥(AR, ME, MRE), ì¶œë ¥(AR, TPR)
                case 'mode2':
                    // 1. ì‹¤ì œ ìˆœì´ìµ (ANI) = AR - ì›”ì§€ì¶œ*12
                    actualNetIncome = annualRevenue - annualExp;
                    
                    // 2. ê³¼ì„¸í‘œì¤€ (TNI) = ANI - ì›”í•„ìš”ê²½ë¹„*12
                    taxBaseIncome = actualNetIncome - annualReqExpInput;
                    
                    // 3. ëª©í‘œì†Œë“ë¥  (TPR) = TNI / AR
                    calculatedTargetProfitRate = (annualRevenue !== 0) ? (taxBaseIncome / annualRevenue) * 100 : 0;

                    calculatedMonthlyRequiredExpense = monthlyRequiredExpense;
                    break;
                
                // Mode 3: ì…ë ¥(AR, ME, MTNI), ì¶œë ¥(AR, MRE)
                case 'mode3':
                    // ëª©í‘œ ì„¸ì „ ìˆœì´ìµ (TNI) = MTNIë¥¼ ì„ì˜ì„¸ìœ¨ë¡œ ì—­ì‚°í•œ ê°’
                    const targetTNI_M3 = (afterTaxNetIncome * 12) / (1 - DUMMY_TAX_RATE);
                    
                    const actualNetIncome_M3 = annualRevenue - annualExp;
                    
                    // MRE = (ANI - TNI) / 12
                    calculatedMonthlyRequiredExpense = (actualNetIncome_M3 - targetTNI_M3) / 12;

                    calculatedTargetProfitRate = targetProfitRate;
                    
                    // ANI (ì‹¤ì œ ìˆœì´ìµ)ì™€ TNI (ê³¼ì„¸í‘œì¤€) ê³„ì‚°
                    actualNetIncome = actualNetIncome_M3;
                    taxBaseIncome = targetTNI_M3;
                    break;
                    
                // Mode 4: ì…ë ¥(AR, ME, TPR), ì¶œë ¥(MRE, MTNI)
                case 'mode4':
                    // 1. ì‹¤ì œ ìˆœì´ìµ (ANI) = AR - ì›”ì§€ì¶œ*12
                    actualNetIncome = annualRevenue - annualExp;
                    
                    // 2. ê³¼ì„¸í‘œì¤€ (TNI) = AR * TPR (ëª©í‘œ ì†Œë“ë¥  ê¸°ë°˜)
                    taxBaseIncome = annualRevenue * (targetProfitRate / 100);
                    
                    // 3. ì›”í•„ìš”ê²½ë¹„ (MRE) = (ANI - TNI) / 12
                    calculatedMonthlyRequiredExpense = (actualNetIncome - taxBaseIncome) / 12;
                    
                    calculatedAnnualRevenue = annualRevenue;
                    calculatedTargetProfitRate = targetProfitRate;
                    break;
                    
                // Mode 5: ì…ë ¥(AR, ME, MTNI), ì¶œë ¥(MRE, TPR)
                case 'mode5':
                    // ëª©í‘œ ì„¸ì „ ìˆœì´ìµ (TNI) = MTNIë¥¼ ì„ì˜ì„¸ìœ¨ë¡œ ì—­ì‚°í•œ ê°’
                    const targetTNI_M5 = (afterTaxNetIncome * 12) / (1 - DUMMY_TAX_RATE);
                    
                    // 1. ì‹¤ì œ ìˆœì´ìµ (ANI) = AR - ì›”ì§€ì¶œ*12
                    actualNetIncome = annualRevenue - annualExp;
                    
                    // 2. ì›”í•„ìš”ê²½ë¹„ (MRE) = (ANI - TNI) / 12
                    calculatedMonthlyRequiredExpense = (actualNetIncome - targetTNI_M5) / 12;
                    
                    // 3. ëª©í‘œì†Œë“ë¥  (TPR) = TNI / AR
                    calculatedTargetProfitRate = (annualRevenue !== 0) ? (targetTNI_M5 / annualRevenue) * 100 : 0;

                    calculatedAnnualRevenue = annualRevenue;
                    break;
                default:
                    taxBaseIncome = 0;
                    break;
            }
            
            // ëª¨ë“  ê²°ê³¼ ê°’ì´ ìœ íš¨í•œ ìˆ«ìì¸ì§€ í™•ì¸í•˜ê³ , ì•„ë‹ˆë©´ 0ìœ¼ë¡œ ë³´ì • (BUG FIX ê°•í™”)
            const validate = (val) => Number.isFinite(val) ? val : 0;
            
            const finalAnnualRev = validate(calculatedAnnualRevenue);
            const finalMonthlyRev = validate(finalAnnualRev / 12);
            const finalAnnualReqExp = validate(calculatedMonthlyRequiredExpense * 12);
            const finalMonthlyReqExp = validate(calculatedMonthlyRequiredExpense);
            const finalTargetProfitRate = validate(calculatedTargetProfitRate);
            
            // --- ìµœì¢… ì„¸ê¸ˆ/ë³´í—˜ë£Œ ê³„ì‚° (ëˆ„ì§„ì„¸ìœ¨ ì ìš©) ---
            
            const annualTax = calculateSimulatedIncomeTax(validate(taxBaseIncome)); // ê³¼ì„¸í‘œì¤€(TNI) ê¸°ì¤€
            const annualLocalTax = annualTax * 0.1; // ì§€ë°©ì†Œë“ì„¸ (10%)
            const totalTaxBurden = annualTax + annualLocalTax; // ì´ ì„¸ê¸ˆ ë¶€ë‹´ì•¡ (ì¢…í•©ì†Œë“ì„¸ * 1.1)
            
            const annualPension = validate(taxBaseIncome * 0.045); // ì„ì˜ 4.5% (TNI ê¸°ì¤€)
            const annualInsurance = validate(taxBaseIncome * 0.035); // ì„ì˜ 3.5% (TNI ê¸°ì¤€)

            // Actual Profit Rate is calculated using the PRE-TAX actual net income (ANI)
            const preTaxProfitRate = (finalAnnualRev !== 0) ? (validate(actualNetIncome) / finalAnnualRev) * 100 : 0;
            
            // Target Profit Rate is calculated using the PRE-TAX tax base income (TNI)
            const targetProfitRateCalculated = (finalAnnualRev !== 0) ? (validate(taxBaseIncome) / finalAnnualRev) * 100 : 0;


            // --- ì„¸í›„ ìˆœì´ìµ ìµœì¢… í™•ì • (ì‚¬ìš©ì ìš”ì²­ ê³µì‹ ì ìš©) ---
            // ì„¸í›„ ì—° ìˆœì´ìµ = ì‹¤ì œ ìˆœì´ìµ (ANI) - (ì¢…í•©ì†Œë“ì„¸ * 1.1)
            const finalAnnualNetIncomePostTax = validate(actualNetIncome - totalTaxBurden);
            const finalMonthlyNetIncomePostTax = validate(finalAnnualNetIncomePostTax / 12);
            
            return {
                annualRev: finalAnnualRev,
                monthlyRev: finalMonthlyRev,
                annualExp: annualExp,
                monthlyExp: monthlyExpense,
                annualReqExp: finalAnnualReqExp,
                monthlyReqExp: finalMonthlyReqExp,
                actualProfitRate: validate(preTaxProfitRate), // ì‹¤ì œ ìˆœì´ìµ / ì—°ë§¤ì¶œ (í•­ìƒ 0 ì´ìƒ)
                targetProfitRate: validate(targetProfitRateCalculated), // ëª©í‘œ ìˆœì´ìµ / ì—°ë§¤ì¶œ (í•­ìƒ 0 ì´ìƒ)
                annualNetIncome: finalAnnualNetIncomePostTax, // UIì— í‘œì‹œë˜ëŠ” ìµœì¢… ì„¸í›„ ìˆœì´ìµ
                monthlyNetIncome: finalMonthlyNetIncomePostTax,
                annualTax: annualTax, // ì¢…í•©ì†Œë“ì„¸ (ì§€ë°©ì„¸ ì œì™¸)
                monthlyTax: annualTax / 12,
                annualPension: annualPension,
                monthlyPension: annualPension / 12,
                annualInsurance: annualInsurance,
                monthlyInsurance: annualInsurance / 12,
            };
        };


        // --- Constants and State Initialization ---
        
        const EMPTY_INPUTS = {
            annualRevenue: 0,
            monthlyExpense: 0,
            monthlyRequiredExpense: 0,
            targetProfitRate: 0,
            afterTaxNetIncome: 0,
        };
        
        // --- State Management (using a global object to simulate state) ---
        let state = {
            calculationMode: 'mode1',
            inputs: {...EMPTY_INPUTS}, // Set all inputs to zero initially
            // lastCalculatedResults ì´ˆê¸°í™” ì‹œ actualProfitRateê°€ 0.0ìœ¼ë¡œ ëª…í™•íˆ ì„¤ì •ë˜ë„ë¡ calculateResults ì‚¬ìš©
            lastCalculatedResults: calculateResults(EMPTY_INPUTS, 'mode1'), 
            scenarios: [], // Clear default scenarios
            simulationModes: [
                { id: 'mode1', label: '1. ì—°ë§¤ì¶œ & ì„¸í›„ìˆœì´ìµ ì‚°ì¶œ', desc: 'ì›”ì§€ì¶œ, ì›”í•„ìš”ê²½ë¹„, ëª©í‘œì†Œë“ë¥ ì„ ê¸°ë°˜ìœ¼ë¡œ ì—°ë§¤ì¶œ/ìˆœì´ìµì„ ì—­ì‚°í•©ë‹ˆë‹¤.', icon: 'ğŸ“ˆ' },
                { id: 'mode2', label: '2. ì—°ë§¤ì¶œ & ëª©í‘œì†Œë“ë¥  ì‚°ì¶œ', desc: 'ë§¤ì¶œê³¼ ì†Œë“ë¥ ì„ ì…ë ¥í•˜ì—¬ ìˆœì´ìµì„ ê³„ì‚°í•©ë‹ˆë‹¤.', icon: 'ğŸ“Š' },
                { id: 'mode3', label: '3. ì—°ë§¤ì¶œ & í•„ìš”ê²½ë¹„ ì‚°ì¶œ', desc: 'ë§¤ì¶œê³¼ í•„ìš”ê²½ë¹„ë¥¼ ì…ë ¥í•˜ì—¬ ëª©í‘œ ì†Œë“ë¥ ì„ ì§„ë‹¨í•©ë‹ˆë‹¤.', icon: 'ğŸ§®' },
                { id: 'mode4', label: '4. í•„ìš”ê²½ë¹„ & ì„¸í›„ìˆœì´ìµ ì‚°ì¶œ', desc: 'í•„ìš”ê²½ë¹„ì™€ ìˆœì´ìµì„ í†µí•´ ì˜ˆìƒ ë§¤ì¶œì„ ê³„ì‚°í•©ë‹ˆë‹¤.', icon: 'ğŸ’°' },
                { id: 'mode5', label: '5. í•„ìš”ê²½ë¹„ & ëª©í‘œì†Œë“ë¥  ì‚°ì¶œ', desc: 'í•„ìš”ê²½ë¹„ì™€ ì†Œë“ë¥ ì„ í†µí•´ ì˜ˆìƒ ë§¤ì¶œ/ìˆœì´ìµì„ ê³„ì‚°í•©ë‹ˆë‹¤.', icon: 'ğŸ¯' }
            ],
            // Lucid icons mapped to emojis for simpler HTML rendering
            iconMap: {
                'TrendingUp': 'ğŸ“ˆ', 'PieChart': 'ğŸ“Š', 'Calculator': 'ğŸ§®',
                'DollarSign': 'ğŸ’°', 'Target': 'ğŸ¯', 'Activity': 'ğŸ’¡',
                'FileText': 'ğŸ“„', 'RotateCcw': 'ğŸ”„', 'Plus': 'â•',
                'Trash2': 'ğŸ—‘ï¸', 'Save': 'ğŸ’¾', 'ArrowRightCircle': 'â¡ï¸'
            },
            // DOM Elements cache for performance optimization
            domRefs: {}
        };
        
        // --- Helper Functions ---
        const formatCurrency = (val) => {
            return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(val);
        };
        
        // --- ì‰¼í‘œ êµ¬ë¶„ ì „ì²´ ìˆ«ìë¡œ ë³€ê²½ ---
        const formatCompactCurrency = (val) => {
            if (val === 0) return '0';
            const displayValue = new Intl.NumberFormat('ko-KR', { 
                style: 'decimal', 
                maximumFractionDigits: 0 
            }).format(val);
            
            return displayValue;
        };

        // --- ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™” ì—¬ë¶€ íŒë‹¨ í•¨ìˆ˜ ---
        const isInputDisabled = (fieldName) => {
            const mode = state.calculationMode;
            // ë¹„í™œì„±í™”ëœ í•„ë“œëŠ” í•´ë‹¹ ëª¨ë“œì˜ ì‚°ì¶œê°’ìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
            switch (mode) {
                case 'mode1': // ì¶œë ¥: ì—°ë§¤ì¶œ, ì„¸í›„ì›”ìˆœì´ìµ
                    return fieldName === 'annualRevenue' || fieldName === 'afterTaxNetIncome';
                case 'mode2': // ì¶œë ¥: ì—°ë§¤ì¶œ, ëª©í‘œì†Œë“ë¥ 
                    return fieldName === 'annualRevenue' || fieldName === 'targetProfitRate';
                case 'mode3': // ì¶œë ¥: ì—°ë§¤ì¶œ, ì›”í•„ìš”ê²½ë¹„
                    return fieldName === 'annualRevenue' || fieldName === 'monthlyRequiredExpense';
                case 'mode4': // ì¶œë ¥: ì›”í•„ìš”ê²½ë¹„, ì„¸í›„ì›”ìˆœì´ìµ
                    return fieldName === 'monthlyRequiredExpense' || fieldName === 'afterTaxNetIncome';
                case 'mode5': // ì¶œë ¥: ì›”í•„ìš”ê²½ë¹„, ëª©í‘œì†Œë“ë¥ 
                    return fieldName === 'monthlyRequiredExpense' || fieldName === 'targetProfitRate';
                default:
                    return false;
            }
        };

        const getModeLabel = (mode) => {
            switch(mode) {
                case 'mode1': return '1. ì—°ë§¤ì¶œ & ì„¸í›„ìˆœì´ìµ ì‚°ì¶œ';
                case 'mode2': return '2. ì—°ë§¤ì¶œ & ëª©í‘œì†Œë“ë¥  ì‚°ì¶œ';
                case 'mode3': return '3. ì—°ë§¤ì¶œ & í•„ìš”ê²½ë¹„ ì‚°ì¶œ';
                case 'mode4': return '4. í•„ìš”ê²½ë¹„ & ì„¸í›„ìˆœì´ìµ ì‚°ì¶œ';
                case 'mode5': return '5. í•„ìš”ê²½ë¹„ & ëª©í‘œì†Œë“ë¥  ì‚°ì¶œ';
                default: return '';
            }
        };


        // --- Render Functions ---
        
        // Dynamic Result Card Generator
        const createDynamicResultCard = (title, annual, monthly, isPercentage, colorClass, icon) => {
            const annualValue = isPercentage ? (annual?.toFixed(1) || 0) + '%' : (typeof annual === 'number' ? formatCurrency(Math.round(annual)) : annual);
            const monthlyValue = typeof monthly === 'number' ? formatCurrency(Math.round(monthly)) : monthly;
            
            return `
                <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-200 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 rounded-bl-xl opacity-10 ${colorClass}">
                        ${icon}
                    </div>
                    <h4 class="text-sm font-bold text-slate-500 mb-3 flex items-center gap-2">
                        <span class="text-slate-400">${icon}</span> ${title} <span class="text-xs font-normal text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full">ì‚°ì¶œê°’</span>
                    </h4>
                    
                    <div class="space-y-3">
                        ${!isPercentage ? `
                            <div class="flex justify-between items-end border-b border-slate-100 pb-2">
                                <span class="text-xs text-slate-400">ì—°ê°„</span>
                                <span class="text-lg font-bold text-slate-800">${annualValue}</span>
                            </div>
                            <div class="flex justify-between items-end">
                                <span class="text-xs text-slate-400">ì›”ê°„</span>
                                <span class="text-lg font-bold text-slate-800">${monthlyValue}</span>
                            </div>
                        ` : `
                            <div class="flex justify-between items-end pt-2">
                                <span class="text-xs text-slate-400">ëª©í‘œ ë¹„ìœ¨</span>
                                <span class="text-2xl font-bold text-slate-800">${annualValue}</span>
                            </div>
                        `}
                    </div>
                </div>
            `;
        };

        // Fixed Result Card Generator
        const createFixedResultCard = (title, value1Label, value1, value2Label, value2, icon, colorText = "text-slate-800") => {
            // value1: ì‹¤ì œì†Œë“ë¥ , value2: ëª©í‘œì†Œë“ë¥ 
            
            if (title === 'ì†Œë“ë¥ ') {
                 // ì†Œë“ë¥  ì „ìš© í¬ë§·
                 return `
                    <div class="bg-slate-50 rounded-xl p-5 border border-slate-200">
                        <h4 class="text-sm font-bold text-slate-500 mb-3 flex items-center gap-2">
                            <span class="text-slate-400">${icon}</span> ${title} <span class="text-xs font-normal text-slate-400 bg-slate-200 px-2 py-0.5 rounded-full">ê³ ì •</span>
                        </h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center border-b border-slate-100 pb-2">
                                <span class="text-xs text-slate-400">ì‹¤ì œì†Œë“ë¥ </span>
                                <span class="text-lg font-bold text-slate-800">${value1}</span> <!-- ìƒ‰ìƒ ë³€ê²½: text-indigo-600 -> text-slate-800 -->
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-slate-400">ëª©í‘œì†Œë“ë¥ </span>
                                <span class="text-lg font-bold text-slate-800">${value2}</span>
                            </div>
                        </div>
                    </div>
                 `;

            } else {
                 // ê¸°ì¡´ ê³ ì • ê²°ê³¼ í¬ë§· (ì¢…í•©ì†Œë“ì„¸)
                 return `
                    <div class="bg-slate-50 rounded-xl p-5 border border-slate-200">
                        <h4 class="text-sm font-bold text-slate-500 mb-3 flex items-center gap-2">
                            <span class="text-slate-400">${icon}</span> ${title} <span class="text-xs font-normal text-slate-400 bg-slate-200 px-2 py-0.5 rounded-full">ê³ ì •</span>
                        </h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center border-b border-slate-100 pb-2">
                                <span class="text-xs text-slate-400">${value1Label}</span>
                                <span class="text-lg font-bold ${colorText}">${value1}</span>
                            </div>
                            ${value2Label ? `
                            <div class="flex justify-between items-center">
                                    <span class="text-xs text-slate-400">${value2Label}</span>
                                    <span class="text-lg font-bold ${colorText}">${value2}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                 `;
            }
        };

        // Dashboard Rendering
        const renderDashboard = () => {
            // DashboardëŠ” lastCalculatedResultsì— ì˜ì¡´í•©ë‹ˆë‹¤.
            const currentResults = state.lastCalculatedResults;
            const { annualRev, monthlyRev, annualReqExp, monthlyReqExp, targetProfitRate, annualNetIncome, monthlyNetIncome, actualProfitRate, annualTax } = currentResults;

            let card1 = '';
            let card2 = '';

            // 1. Determine card names and values based on explicit user request for the output structure
            switch (state.calculationMode) {
                case 'mode1': // 1. ì˜ˆìƒ ë§¤ì¶œ / ì˜ˆìƒ ì„¸í›„ìˆœì´ìµ
                    card1 = createDynamicResultCard("ì˜ˆìƒ ë§¤ì¶œ", annualRev, monthlyRev, false, "bg-emerald-500", state.iconMap.TrendingUp);
                    card2 = createDynamicResultCard("ì˜ˆìƒ ì„¸í›„ìˆœì´ìµ", annualNetIncome, monthlyNetIncome, false, "bg-blue-500", state.iconMap.DollarSign);
                    break;
                case 'mode2': // 2. ì˜ˆìƒ ë§¤ì¶œ / ëª©í‘œì†Œë“ë¥ 
                    card1 = createDynamicResultCard("ì˜ˆìƒ ë§¤ì¶œ", annualRev, monthlyRev, false, "bg-emerald-500", state.iconMap.TrendingUp);
                    card2 = createDynamicResultCard("ëª©í‘œì†Œë“ë¥ ", targetProfitRate, 0, true, "bg-purple-500", state.iconMap.Target);
                    break;
                case 'mode3': // 3. ì˜ˆìƒ ë§¤ì¶œ / í•„ìš”ê²½ë¹„
                    card1 = createDynamicResultCard("ì˜ˆìƒ ë§¤ì¶œ", annualRev, monthlyRev, false, "bg-emerald-500", state.iconMap.TrendingUp);
                    // ì—°ê°„ í•„ìš” ê²½ë¹„ë¥¼ ì›”ê°„ìœ¼ë¡œ ë³´ì—¬ì£¼ë¯€ë¡œ ì›” í•„ìš” ê²½ë¹„ ë°ì´í„°ë¥¼ ì‚¬ìš© (titleì€ ìš”ì²­ëŒ€ë¡œ 'í•„ìš”ê²½ë¹„'ë§Œ ì‚¬ìš©)
                    card2 = createDynamicResultCard("í•„ìš”ê²½ë¹„", annualReqExp, monthlyReqExp, false, "bg-orange-500", state.iconMap.Calculator);
                    break;
                case 'mode4': // 4. í•„ìš”ê²½ë¹„ / ì˜ˆìƒ ì„¸í›„ìˆœì´ìµ
                    // ì›” í•„ìš” ê²½ë¹„ ë°ì´í„°ë¥¼ ì‚¬ìš© (titleì€ ìš”ì²­ëŒ€ë¡œ 'í•„ìš”ê²½ë¹„'ë§Œ ì‚¬ìš©)
                    card1 = createDynamicResultCard("í•„ìš”ê²½ë¹„", annualReqExp, monthlyReqExp, false, "bg-orange-500", state.iconMap.Calculator);
                    card2 = createDynamicResultCard("ì˜ˆìƒ ì„¸í›„ìˆœì´ìµ", annualNetIncome, monthlyNetIncome, false, "bg-blue-500", state.iconMap.DollarSign);
                    break;
                case 'mode5': // 5. í•„ìš”ê²½ë¹„ / ëª©í‘œì†Œë“ë¥ 
                    // ì›” í•„ìš” ê²½ë¹„ ë°ì´í„°ë¥¼ ì‚¬ìš© (titleì€ ìš”ì²­ëŒ€ë¡œ 'í•„ìš”ê²½ë¹„'ë§Œ ì‚¬ìš©)
                    card1 = createDynamicResultCard("í•„ìš”ê²½ë¹„", annualReqExp, monthlyReqExp, false, "bg-orange-500", state.iconMap.Calculator);
                    card2 = createDynamicResultCard("ëª©í‘œì†Œë“ë¥ ", targetProfitRate, 0, true, "bg-purple-500", state.iconMap.Target);
                    break;
                default:
                    // Fallback to a sensible default
                    card1 = createDynamicResultCard("ì˜ˆìƒ ë§¤ì¶œ", annualRev, monthlyRev, false, "bg-emerald-500", state.iconMap.TrendingUp);
                    card2 = createDynamicResultCard("ì˜ˆìƒ ì„¸í›„ìˆœì´ìµ", annualNetIncome, monthlyNetIncome, false, "bg-blue-500", state.iconMap.DollarSign);
            }
            
            const cardsHtml = card1 + card2;
            
            // ì†Œë“ë¥  í‘œê¸°ë¥¼ ìœ„í•œ ê°’ (lastCalculatedResults ì‚¬ìš©)
            
            // **BUG FIX: Number.isFinite ì²´í¬ë¥¼ í†µí•´ ì•ˆì „í•˜ê²Œ 0.0%ë¡œ ê¸°ë³¸ê°’ ì„¤ì •**
            const formatRate = (rate) => {
                const numericRate = parseFloat(rate);
                return (Number.isFinite(numericRate) ? numericRate : 0).toFixed(1);
            };
            
            const actualRateFormatted = `${formatRate(actualProfitRate)}%`;
            const targetRateFormatted = `${formatRate(targetProfitRate)}%`;

            const fixedCardsHtml = `
                ${createFixedResultCard(
                    "ì†Œë“ë¥ ", // ëª…ì¹­ ë³€ê²½
                    null, // value1Label (Not used)
                    actualRateFormatted, // value1 (ì‹¤ì œì†Œë“ë¥ )
                    null, // value2Label (Not used)
                    targetRateFormatted, // value2 (ëª©í‘œì†Œë“ë¥ )
                    state.iconMap.PieChart 
                )}
                ${createFixedResultCard(
                    "ì¢…í•©ì†Œë“ì„¸", 
                    "ì—°ê°„", // 'ì˜ˆìƒ' ì œê±°
                    formatCurrency(annualTax), 
                    "ì›”ê°„", // 'ì˜ˆìƒ' ì œê±°
                    formatCurrency(annualTax / 12),
                    state.iconMap.FileText 
                )}
            `;

            // Insight Calculation for Alert Box
            const industryAvg = 40;
            // actualProfitRateëŠ” ì´ë¯¸ Number.isFinite ê²€ì‚¬ë¥¼ ê±°ì³¤ìœ¼ë¯€ë¡œ ì•ˆì „í•˜ê²Œ ì‚¬ìš©
            const currentActualRate = actualProfitRate;
            const diff = industryAvg - currentActualRate;
            const diffText = diff > 0 ? `ë‚®ìŠµë‹ˆë‹¤` : `ë†’ìŠµë‹ˆë‹¤`;
            const insightText = `
                í˜„ì¬ ì†Œë“ë¥ (<strong>${currentActualRate.toFixed(1)}%</strong>)ì€ ë™ì¢… ì—…ê³„ í‰ê· (${industryAvg}%) ëŒ€ë¹„ <strong>${Math.abs(diff).toFixed(1)}%</strong> ${diffText}. 
                <br/>
                í•„ìš”ê²½ë¹„ë¥¼ <strong>â‚©${formatCompactCurrency(currentResults.monthlyReqExp)}</strong>ìœ¼ë¡œ ìœ ì§€í•  ê²½ìš°, ëª©í‘œ ì†Œë“ë¥  ë‹¬ì„±ì„ ìœ„í•´ ì—°ë§¤ì¶œ <strong>â‚©${formatCompactCurrency(currentResults.annualRev)}</strong>ì´ í•„ìš”í•©ë‹ˆë‹¤.
            `;

            state.domRefs.dashboardCards.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">${cardsHtml}</div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">${fixedCardsHtml}</div>
            `;
            
            state.domRefs.dashboardInsightMode.textContent = getModeLabel(state.calculationMode).split('.')[1].trim();
            state.domRefs.dashboardInsightText.innerHTML = insightText;
        };
        
        // Table Rendering
        const renderScenarioTable = () => {
            const tbody = state.domRefs.scenarioTableBody;
            let html = '';

            if (state.scenarios.length === 0) {
                 html = `
                    <tr>
                        <td colspan="18" class="px-6 py-12 text-center text-slate-400 bg-slate-50/30">
                            ì…ë ¥ í¼ì„ í†µí•´ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.
                        </td>
                    </tr>
                `;
            } else {
                state.scenarios.forEach((item, idx) => {
                    html += `
                        <tr class="hover:bg-slate-50/80 transition-colors">
                            <td class="px-3 py-3 text-center font-medium text-slate-400 border-r border-slate-100 sticky sticky-col sticky-col-1 bg-white z-10">${idx + 1}</td>
                            <td class="px-4 py-3 text-center border-r border-slate-100 sticky sticky-col sticky-col-2 bg-white z-10">
                                <span class="px-2 py-0.5 rounded-full text-[10px] font-medium bg-slate-100 text-slate-600 truncate block w-24 mx-auto">
                                    ${item.mode.split('.')[0]} ì‹œë‚˜ë¦¬ì˜¤
                                </span>
                            </td>
                            
                            <!-- ì†Œë“ë¥  (ì‹¤ì œ/ëª©í‘œ) - íŒŒë€ìƒ‰ ê³„ì—´, % ì¶”ê°€, ê°„ê²© ë„“í˜ (px-4) -->
                            <td class="px-4 py-3 text-center text-blue-700 font-bold bg-blue-50/30 border-r border-slate-100">
                                ${(item.actualProfitRate).toFixed(1)}%
                            </td>
                            <td class="px-4 py-3 text-center text-blue-600 bg-blue-50/30 border-r border-slate-100">
                                ${(item.targetProfitRate).toFixed(1)}%
                            </td>

                            <!-- ë§¤ì¶œ - íšŒìƒ‰ ê³„ì—´ -->
                            <td class="px-2 py-3 text-right text-slate-700 font-medium bg-slate-50/30 border-r border-slate-100">${formatCompactCurrency(item.annualRev)}</td>
                            <td class="px-2 py-3 text-right text-slate-700 bg-slate-50/30 border-r border-slate-100">${formatCompactCurrency(item.monthlyRev)}</td>

                            <!-- ì§€ì¶œ (ê³ ì • -> ì§€ì¶œ) - íšŒìƒ‰ ê³„ì—´ -->
                            <td class="px-2 py-3 text-right text-slate-700 bg-slate-50/30 border-r border-slate-100">${formatCompactCurrency(item.annualExp)}</td>
                            <td class="px-2 py-3 text-right text-slate-700 bg-slate-50/30 border-r border-slate-100">${formatCompactCurrency(item.monthlyExp)}</td>
                            
                            <!-- í•„ìš”ê²½ë¹„ - íšŒìƒ‰ ê³„ì—´ -->
                            <td class="px-2 py-3 text-right text-slate-700 bg-slate-50/30 border-r border-slate-100">${formatCompactCurrency(item.annualReqExp)}</td>
                            <td class="px-2 py-3 text-right text-slate-700 bg-slate-50/30 border-r border-slate-100">${formatCompactCurrency(item.monthlyReqExp)}</td>
                            
                            <!-- ì„¸í›„ìˆœì´ìµ (ê°•ì¡°) - íŒŒë€ìƒ‰ ê³„ì—´ -->
                            <td class="px-2 py-3 text-right font-bold text-blue-700 bg-blue-50/30 border-r border-slate-100">${formatCompactCurrency(item.annualNetIncome)}</td>
                            <td class="px-2 py-3 text-right font-bold text-blue-700 bg-blue-50/30 border-r border-slate-100">${formatCompactCurrency(item.monthlyNetIncome)}</td>
                            
                            <!-- ì„¸ê¸ˆ/ì—°ê¸ˆ/ë³´í—˜ - íšŒìƒ‰ ê³„ì—´ -->
                            <td class="px-2 py-3 text-right text-slate-500 border-r border-slate-100">${formatCompactCurrency(item.annualTax)}</td>
                            <td class="px-2 py-3 text-right text-slate-500 border-r border-slate-100">${formatCompactCurrency(item.monthlyTax)}</td>

                            <td class="px-2 py-3 text-right text-slate-500 border-r border-slate-100">${formatCompactCurrency(item.annualPension)}</td>
                            <td class="px-2 py-3 text-right text-slate-500 border-r border-slate-100">${formatCompactCurrency(item.monthlyPension)}</td>
                            
                            <td class="px-2 py-3 text-right text-slate-500 border-r border-slate-100">${formatCompactCurrency(item.annualInsurance)}</td>
                            <td class="px-2 py-3 text-right text-slate-500 border-r border-slate-100">${formatCompactCurrency(item.monthlyInsurance)}</td>
                            
                            <td class="px-3 py-3 text-center">
                                <button onclick="handleRemoveScenario(${item.id})" class="text-slate-400 hover:text-red-500 transition-colors p-1">
                                    ğŸ—‘ï¸
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }

            tbody.innerHTML = html;
        };

        // Input Form Update Logic
        const updateInputForm = () => {
            const inputs = state.inputs;
            // ì…ë ¥ í¼ì— í‘œì‹œë˜ëŠ” ê²°ê³¼ëŠ” lastCalculatedResultsì— ì˜ì¡´í•©ë‹ˆë‹¤.
            const currentResults = state.lastCalculatedResults; 
            
            // DOM Refs access
            const { 
                annualRevenueInput, monthlyExpenseInput, monthlyRequiredExpenseInput, 
                targetProfitRateInput, afterTaxNetIncomeInput 
            } = state.domRefs;

            // 1. Update input field values
            [
                { name: 'annualRevenue', input: annualRevenueInput, isCurrency: true, resultName: 'annualRev' }, 
                { name: 'monthlyExpense', input: monthlyExpenseInput, isCurrency: true, resultName: 'monthlyExp' },
                { name: 'monthlyRequiredExpense', input: monthlyRequiredExpenseInput, isCurrency: true, resultName: 'monthlyReqExp' }, 
                { name: 'targetProfitRate', input: targetProfitRateInput, isCurrency: false, resultName: 'targetProfitRate' }, 
                { name: 'afterTaxNetIncome', input: afterTaxNetIncomeInput, isCurrency: true, resultName: 'monthlyNetIncome' }
            ].forEach(({ name, input, isCurrency, resultName }) => {
                const isDisabled = isInputDisabled(name);
                
                // Find the status label span 
                const label = input.closest('div.space-y-5 > div').querySelector('label');
                const statusLabelSpan = label ? label.querySelector('span') : null;

                let valueToDisplay = inputs[name];

                if (isDisabled) {
                    // í•„ë“œê°€ ì‚°ì¶œê°’ì¼ ê²½ìš°, lastCalculatedResultsì˜ ê²°ê³¼ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
                    
                    // 1. ê°’ ì„¤ì • (NaN/0 ë°©ì§€ ë° 0ì¼ ë•Œ '0' ëª…ì‹œ)
                    let resultValue = currentResults[resultName];

                    let formattedValue;
                    if (isCurrency) {
                        const value = Math.round(resultValue);
                        // NaN ë˜ëŠ” ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ "0", ì•„ë‹ˆë©´ ì½¤ë§ˆ í¬ë§·
                        formattedValue = Number.isFinite(value) ? value.toLocaleString() : '0'; 
                    } else if (name === 'targetProfitRate') {
                         // ì†Œë“ë¥ ì€ ì†Œìˆ˜ì  ë‘ ìë¦¬ê¹Œì§€ í‘œì‹œ
                        formattedValue = Number.isFinite(resultValue) ? resultValue.toFixed(2) : '0.00';
                    }
                    input.value = formattedValue; // <--- ê³„ì‚° ê²°ê³¼ ê°•ì œ í• ë‹¹
                    
                    // 2. Styling (íšŒìƒ‰ ìŒì˜)
                    const disabledClasses = 'bg-slate-100 border-slate-200 text-slate-400 cursor-not-allowed';
                    const activeClasses = 'bg-white border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500';

                    // Remove active styles
                    input.classList.remove(...activeClasses.split(' ')); 
                    // Add disabled styles
                    input.classList.add(...disabledClasses.split(' '));

                    // 3. Status label
                    if (statusLabelSpan) statusLabelSpan.style.display = 'inline';
                    
                } else {
                    // í•„ë“œê°€ ì…ë ¥ê°’ì¼ ê²½ìš°, ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’(state.inputs[name])ì„ í‘œì‹œí•©ë‹ˆë‹¤.
                    if (isCurrency) {
                        // ê¸ˆì•¡ 0ì¼ ë•Œ ê³µë€ìœ¼ë¡œ ìœ ì§€ (ì‚¬ìš©ì ì…ë ¥ ê²½í—˜)
                        input.value = valueToDisplay === 0 ? '' : valueToDisplay.toLocaleString();
                    } else {
                        // ìˆ«ì 0ì¼ ë•Œ ê³µë€ìœ¼ë¡œ ìœ ì§€
                        input.value = valueToDisplay === 0 ? '' : valueToDisplay;
                    }

                    // Styling for input fields (visually active)
                    const baseClasses = 'bg-white border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500';
                    const disabledClasses = 'bg-slate-100 border-slate-200 text-slate-400 cursor-not-allowed';
                    input.classList.remove(...disabledClasses.split(' '));
                    input.classList.add(...baseClasses.split(' '));
                    if (statusLabelSpan) statusLabelSpan.style.display = 'none';
                }
                
                input.placeholder = isDisabled ? "ìë™ ê³„ì‚°" : "0";
                // ëª¨ë“  í•„ë“œëŠ” ì…ë ¥ ê°€ëŠ¥í•´ì•¼ í•˜ë¯€ë¡œ disabled=false ìœ ì§€
                input.disabled = false;
            });
        };

        // Mode Selector Rendering
        const renderModeSelectors = () => {
            const container = state.domRefs.modeSelectors;
            let html = '';

            state.simulationModes.forEach(mode => {
                const isActive = state.calculationMode === mode.id;
                const activeClass = isActive ? 'border-blue-600 bg-blue-50 ring-2 ring-blue-100 ring-offset-2 shadow-md' : 'border-slate-200 bg-white hover:border-blue-300 hover:bg-blue-50/30';
                const iconClass = isActive ? 'bg-blue-200 text-blue-700' : 'bg-slate-100 text-slate-500 group-hover:bg-blue-100 group-hover:text-blue-600';
                const labelClass = isActive ? 'text-blue-700' : 'text-slate-700';
                const indicator = isActive ? '<div class="h-2 w-2 rounded-full bg-blue-600 animate-pulse mt-1"></div>' : '';

                html += `
                    <button
                        onclick="setCalculationMode('${mode.id}')"
                        class="relative p-4 rounded-xl border-2 text-left transition-all group ${activeClass}"
                    >
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center gap-2">
                                <div class="p-1.5 rounded-lg ${iconClass}">
                                    ${mode.icon}
                                </div>
                                <span class="font-bold text-sm ${labelClass}">
                                    ${mode.label} <!-- 1. - 5. í¬í•¨ëœ ì „ì²´ ë¼ë²¨ ì¶œë ¥ -->
                                </span>
                            </div>
                            ${indicator}
                        </div>
                        <p class="text-xs text-slate-500 pl-9">${mode.desc}</p>
                    </button>
                `;
            });
            container.innerHTML = html;
        };
        
        // --- Global Render Trigger ---
        const renderApp = () => {
            renderModeSelectors();
            updateInputForm();
            renderDashboard();
            renderScenarioTable();
        };

        // --- Event Handlers (replacing React handlers) ---

        const setCalculationMode = (modeId) => {
            state.calculationMode = modeId;
            renderApp();
        };

        const handleInput = (e) => {
            const { name, value, type } = e.target;
            
            let rawValue;
            if (type === 'text' && (name === 'annualRevenue' || name === 'monthlyExpense' || name === 'monthlyRequiredExpense' || name === 'afterTaxNetIncome')) {
                // ê¸ˆì•¡ ì…ë ¥ (ì½¤ë§ˆ ì œê±°)
                rawValue = Number(value.replace(/,/g, ''));
            } else if (type === 'number' && name === 'targetProfitRate') {
                // ìˆ«ì ì…ë ¥ (í¼ì„¼íŠ¸)
                rawValue = Number(value);
            } else {
                return;
            }

            if (!isNaN(rawValue)) {
                // ì…ë ¥ê°’ë§Œ stateì— ì—…ë°ì´íŠ¸. DashboardëŠ” ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ.
                state.inputs = { ...state.inputs, [name]: rawValue };
                updateInputForm(); // ì…ë ¥ í•„ë“œ ê°’ë§Œ ìƒˆë¡œê³ ì¹¨ (ì‚°ì¶œ í•„ë“œëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€)
            }
        };

        const handleAddScenario = () => {
            // 1. í˜„ì¬ ì…ë ¥ê°’ìœ¼ë¡œ ê³„ì‚°
            const results = calculateResults(state.inputs, state.calculationMode);
            
            // 2. ê³„ì‚° ê²°ê³¼ë¥¼ Dashboardì™€ ì‚°ì¶œ í•„ë“œì— ë°˜ì˜
            state.lastCalculatedResults = results;

            // 3. ì‹œë‚˜ë¦¬ì˜¤ í…Œì´ë¸”ì— ì¶”ê°€
            const newId = state.scenarios.length > 0 ? Math.max(...state.scenarios.map(s => s.id)) + 1 : 1;
            const newScenario = { id: newId, mode: getModeLabel(state.calculationMode), ...results };
            state.scenarios = [...state.scenarios, newScenario];

            // 4. ì „ì²´ ë Œë”ë§ (Dashboard, Form, Table ì—…ë°ì´íŠ¸)
            renderApp();
        };

        const handleRemoveScenario = (id) => {
            state.scenarios = state.scenarios.filter(s => s.id !== id);
            renderApp();
        };

        const handleResetInputs = () => {
            state.inputs = { ...EMPTY_INPUTS };
            state.lastCalculatedResults = calculateResults(EMPTY_INPUTS, 'mode1'); // Dashboard ì´ˆê¸°í™”
            renderApp();
        };

        const handleClearScenarios = () => {
            state.scenarios = [];
            renderApp();
        };

        // DOM caching and initial setup
        window.onload = () => {
            // Cache DOM references
            state.domRefs = {
                modeSelectors: document.getElementById('mode-selectors'),
                dashboardCards: document.getElementById('dashboard-cards'),
                dashboardInsightMode: document.getElementById('dashboard-insight-mode'),
                dashboardInsightText: document.getElementById('dashboard-insight-text'),
                scenarioTableBody: document.getElementById('scenario-table-body'),
                
                annualRevenueInput: document.querySelector('[name="annualRevenue"]'),
                monthlyExpenseInput: document.querySelector('[name="monthlyExpense"]'),
                monthlyRequiredExpenseInput: document.querySelector('[name="monthlyRequiredExpense"]'),
                targetProfitRateInput: document.querySelector('[name="targetProfitRate"]'),
                afterTaxNetIncomeInput: document.querySelector('[name="afterTaxNetIncome"]'),
                
                addScenarioBtn: document.getElementById('add-scenario-btn'),
                resetInputsBtn: document.getElementById('reset-inputs-btn'),
                headerResetBtn: document.getElementById('header-reset-btn'),
                clearScenariosBtn: document.getElementById('clear-scenarios-btn')
            };

            // Attach input change listeners (consolidated)
            state.domRefs.annualRevenueInput.addEventListener('input', handleInput);
            state.domRefs.monthlyExpenseInput.addEventListener('input', handleInput);
            state.domRefs.monthlyRequiredExpenseInput.addEventListener('input', handleInput);
            state.domRefs.targetProfitRateInput.addEventListener('input', handleInput);
            state.domRefs.afterTaxNetIncomeInput.addEventListener('input', handleInput);
            
            // Attach button listeners
            state.domRefs.addScenarioBtn.addEventListener('click', handleAddScenario);
            state.domRefs.resetInputsBtn.addEventListener('click', handleResetInputs);
            state.domRefs.headerResetBtn.addEventListener('click', handleResetInputs);
            state.domRefs.clearScenariosBtn.addEventListener('click', handleClearScenarios);

            // Initial Render
            renderApp();
        };
    </script>
</head>
<body class="min-h-screen bg-slate-50 font-sans text-slate-900">
    <div id="app-root">
        <!-- Header -->
        <header class="bg-white border-b border-slate-200 sticky top-0 z-30">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <div class="bg-blue-600 p-2 rounded-lg">
                        ğŸ§®
                    </div>
                    <h1 class="text-xl font-bold text-slate-800 tracking-tight">Pro-Consulting Lab</h1>
                </div>
                <div class="flex items-center gap-3">
                    <button id="header-reset-btn" class="text-sm text-slate-500 hover:text-slate-800 px-3 py-2 flex items-center gap-1 transition-colors rounded-lg">
                        ğŸ”„ ì´ˆê¸°í™”
                    </button>
                    <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 shadow-sm transition-colors">
                        ğŸ’¾ ë°ì´í„° ì €ì¥
                    </button>
                </div>
            </div>
        </header>

        <main class="max-w-[1800px] mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- 1. Calculation Mode Selector -->
            <section class="mb-8">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    ğŸ’¡ ì‹œë®¬ë ˆì´ì…˜ ê¸°ì¤€ ì„¤ì •
                </h2>
                <div id="mode-selectors" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4">
                    <!-- Mode buttons rendered by JavaScript -->
                </div>
            </section>

            <!-- 2. Input & Immediate Result Area -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-10">
                <!-- Left: Input Form -->
                <div class="lg:col-span-1 bg-white rounded-2xl shadow-xl border border-slate-200 p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-lg text-slate-800">ê¸°ì´ˆ ë°ì´í„° ì…ë ¥</h3>
                        <span class="text-xs font-medium px-2 py-1 bg-slate-100 rounded text-slate-500">ë‹¨ìœ„: ì›</span>
                    </div>
                    
                    <div class="space-y-5" id="input-form">
                        <!-- ì—°ë§¤ì¶œ -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1.5 flex justify-between">
                                ì—°ë§¤ì¶œ
                                <span style="display: none;" class="text-xs text-blue-500 font-normal self-center">ìë™ ì‚°ì¶œë¨</span>
                            </label>
                            <input type="text" name="annualRevenue" placeholder="0" class="w-full px-4 py-2.5 rounded-lg border transition-colors" />
                        </div>

                        <!-- ì›”ì§€ì¶œ -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1.5">ì›”ì§€ì¶œ</label>
                            <input type="text" name="monthlyExpense" placeholder="0" class="w-full px-4 py-2.5 rounded-lg border transition-colors" />
                        </div>

                        <!-- ì›”í•„ìš”ê²½ë¹„ -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1.5 flex justify-between">
                                ì›”í•„ìš”ê²½ë¹„
                                <span style="display: none;" class="text-xs text-blue-500 font-normal self-center">ìë™ ì‚°ì¶œë¨</span>
                            </label>
                            <input type="text" name="monthlyRequiredExpense" placeholder="0" class="w-full px-4 py-2.5 rounded-lg border transition-colors" />
                        </div>

                        <!-- ëª©í‘œì†Œë“ë¥  -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1.5 flex justify-between">
                                ëª©í‘œì†Œë“ë¥  (%)
                                <span style="display: none;" class="text-xs text-blue-500 font-normal self-center">ìë™ ì‚°ì¶œë¨</span> 
                            </label>
                            <div class="relative">
                                <input type="number" name="targetProfitRate" placeholder="0" class="w-full px-4 py-2.5 rounded-lg border transition-colors pr-8" />
                                <span class="absolute right-3 top-2.5 text-slate-400">%</span>
                            </div>
                        </div>

                        <!-- ì„¸í›„ì›”ìˆœì´ìµ -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1.5 flex justify-between">
                                ì„¸í›„ì›”ìˆœì´ìµ
                                <span style="display: none;" class="text-xs text-blue-500 font-normal self-center">ìë™ ì‚°ì¶œë¨</span>
                            </label>
                            <input type="text" name="afterTaxNetIncome" placeholder="0" class="w-full px-4 py-2.5 rounded-lg border transition-colors" />
                        </div>

                        <!-- Buttons Section: Calculate & Reset -->
                        <div class="grid grid-cols-2 gap-3 mt-8 pt-4 border-t border-slate-100">
                            <button id="add-scenario-btn" class="bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-semibold shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2 transform hover:scale-[1.02] active:scale-100">
                                ğŸ§® ê³„ì‚°í•˜ê¸°
                            </button>
                            <button id="reset-inputs-btn" class="bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 py-3 rounded-xl font-semibold transition-all flex items-center justify-center gap-2">
                                ğŸ”„ ì…ë ¥ ì´ˆê¸°í™”
                            </button>
                        </div>

                    </div>
                </div>

                <!-- Right: Preview / Quick Dashboard -->
                <div class="lg:col-span-2 space-y-6">
                    
                    <h3 class="font-bold text-lg text-slate-800 mb-4 flex items-center gap-2">
                        â¡ï¸ ì‹¤ì‹œê°„ ë¶„ì„ ëŒ€ì‹œë³´ë“œ
                    </h3>

                    <div id="dashboard-cards" class="space-y-4">
                        <!-- Dashboard cards rendered by JavaScript -->
                    </div>

                    <!-- Alert / Notifications Area -->
                    <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 flex items-start gap-3">
                        <div class="p-1 bg-amber-100 rounded text-amber-600 mt-1">
                            ğŸ“ˆ
                        </div>
                        <div>
                            <h4 class="text-sm font-bold text-amber-800">ì»¨ì„¤íŒ… ì¸ì‚¬ì´íŠ¸ (<span id="dashboard-insight-mode"></span>)</h4>
                            <p class="text-sm text-amber-700 mt-1 leading-relaxed" id="dashboard-insight-text">
                                <!-- Insight text rendered by JavaScript -->
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. Comprehensive Data Table -->
            <div class="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden">
                <div class="p-5 border-b border-slate-200 flex justify-between items-center bg-slate-50/50">
                    <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                        ğŸ“„ ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ ë¶„ì„
                    </h3>
                    <div class="flex gap-2">
                        <button class="text-xs font-medium bg-white border border-slate-300 px-3 py-1.5 rounded-lg hover:bg-slate-50 transition-colors">Excel ë‹¤ìš´ë¡œë“œ</button>
                        <button id="clear-scenarios-btn" class="text-xs font-medium bg-white border border-slate-300 px-3 py-1.5 rounded-lg hover:bg-red-50 transition-colors text-red-500 border-red-200">
                            ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="w-full text-xs text-left border-collapse">
                        <thead class="bg-slate-50 text-slate-600 font-semibold border-b border-slate-200 sticky top-0 z-20">
                            <tr>
                                <th rowspan="2" class="px-3 py-4 whitespace-nowrap text-center border-r border-slate-200 sticky sticky-col sticky-col-1 bg-slate-50 z-20">No</th>
                                <th rowspan="2" class="px-4 py-4 whitespace-nowrap text-center border-r border-slate-200 sticky sticky-col sticky-col-2 bg-slate-50 z-20">êµ¬ë¶„</th>
                                
                                <!-- ì†Œë“ë¥  (í—¤ë”ì—ì„œ % ì œê±°) -->
                                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200 bg-blue-50 text-blue-800">ì†Œë“ë¥ </th>
                                
                                <!-- ë§¤ì¶œ (íšŒìƒ‰ ê³„ì—´) -->
                                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200 bg-slate-100 text-slate-800">ë§¤ì¶œ</th>

                                <!-- ì§€ì¶œ (ê³ ì • ì§€ì¶œ -> ì§€ì¶œ) (íšŒìƒ‰ ê³„ì—´) -->
                                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200 bg-slate-100 text-slate-800">ì§€ì¶œ</th>

                                <!-- í•„ìš”ê²½ë¹„ (íšŒìƒ‰ ê³„ì—´) -->
                                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200 bg-slate-100 text-slate-800">í•„ìš” ê²½ë¹„</th>

                                <!-- ì„¸í›„ìˆœì´ìµ (íŒŒë€ìƒ‰ ê³„ì—´) -->
                                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200 bg-blue-50 text-blue-800">ì„¸í›„ìˆœì´ìµ</th>
                                
                                <!-- ì„¸ê¸ˆ/ì—°ê¸ˆ/ë³´í—˜ (íšŒìƒ‰ ê³„ì—´) -->
                                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200">ì¢…í•©ì†Œë“ì„¸</th>
                                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200">êµ­ë¯¼ì—°ê¸ˆ</th>
                                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200">ê±´ê°•ë³´í—˜ë£Œ</th>
                                <th rowspan="2" class="px-3 py-4 text-center">ê´€ë¦¬</th>
                            </tr>
                            <tr class="bg-slate-50/50 text-[11px] text-slate-500">
                                <!-- ì†Œë“ë¥  í•˜ìœ„ (ê°„ê²© px-4, íŒŒë€ìƒ‰ ê³„ì—´) -->
                                <th class="px-4 py-2 text-center border-r border-slate-200 bg-blue-50/50 text-blue-800">ì‹¤ì œ</th>
                                <th class="px-4 py-2 text-center border-r border-slate-200 bg-blue-50/50 text-blue-800">ëª©í‘œ</th>
                                
                                <!-- ë§¤ì¶œ í•˜ìœ„ (íšŒìƒ‰ ê³„ì—´) -->
                                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì—°ê°„</th>
                                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì›”ê°„</th>

                                <!-- ì§€ì¶œ í•˜ìœ„ (íšŒìƒ‰ ê³„ì—´) -->
                                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì—°ê°„</th>
                                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì›”ê°„</th>

                                <!-- í•„ìš”ê²½ë¹„ í•˜ìœ„ (íšŒìƒ‰ ê³„ì—´) -->
                                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì—°ê°„</th>
                                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì›”ê°„</th>

                                <!-- ì„¸í›„ìˆœì´ìµ í•˜ìœ„ (íŒŒë€ìƒ‰ ê³„ì—´) -->
                                <th class="px-2 py-2 text-center border-r border-slate-200 bg-blue-50/50 text-blue-800">ì—°ê°„</th>
                                <th class="px-2 py-2 text-center border-r border-slate-200 bg-blue-50/50 text-blue-800">ì›”ê°„</th>
                                
                                <!-- ì„¸ê¸ˆ/ì—°ê¸ˆ/ë³´í—˜ í•˜ìœ„ (íšŒìƒ‰ ê³„ì—´) -->
                                <th class="px-2 py-2 text-center border-r border-slate-200">ì—°ê°„</th>
                                <th class="px-2 py-2 text-center border-r border-slate-200">ì›”ê°„</th>
                                <th class="px-2 py-2 text-center border-r border-slate-200">ì—°ê°„</th>
                                <th class="px-2 py-2 text-center border-r border-slate-200">ì›”ê°„</th>
                                <th class="px-2 py-2 text-center border-r border-slate-200">ì—°ê°„</th>
                                <th class="px-2 py-2 text-center border-r border-slate-200">ì›”ê°„</th>
                            </tr>
                        </thead>
                        <tbody id="scenario-table-body" class="divide-y divide-slate-100">
                            <!-- Table rows rendered by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
