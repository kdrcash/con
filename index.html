<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pro-Consulting Lab</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    .sticky-col-1 { left:0; z-index:20; box-shadow:2px 0 5px -2px rgba(0,0,0,0.1); }
    .sticky-col-2 { left:40px; z-index:20; box-shadow:2px 0 5px -2px rgba(0,0,0,0.1); }
    .table-container { overflow-x:auto; }
    .sticky-col { position:sticky; }
  </style>

  <script>
    /* ======================================================================
      Pro-Consulting Lab (Single HTML)
      ì •ì±…(ìš”ì²­ ë°˜ì˜)
      - ì…ë ¥ ì¤‘ì—ëŠ” ì„œë²„ ê³„ì‚°/ëŒ€ì‹œë³´ë“œ ê°±ì‹ ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤.
      - "ğŸ§® ê³„ì‚°í•˜ê¸°" ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œë§Œ:
        (1) ì„œë²„ ê³„ì‚° â†’ (2) ëŒ€ì‹œë³´ë“œ ê°±ì‹  â†’ (3) ì‹œë‚˜ë¦¬ì˜¤ í…Œì´ë¸”ì— ì¶”ê°€
      - "ğŸ”„ ì´ˆê¸°í™”"(í—¤ë”) / "ğŸ”„ ì…ë ¥ ì´ˆê¸°í™”"(ì¢Œì¸¡) ë²„íŠ¼ì€
        ì…ë ¥ + ëŒ€ì‹œë³´ë“œ + ì‹œë‚˜ë¦¬ì˜¤ê¹Œì§€ ì „ë¶€ ì´ˆê¸°í™”í•œë‹¤.

      ìµœì í™”(v1)
      - Intl.NumberFormat / DOM ìš”ì†Œë¥¼ ìºì‹±í•´ ë¶ˆí•„ìš”í•œ DOM íƒìƒ‰/ê°ì²´ìƒì„± ê°ì†Œ
      - ì‹œë‚˜ë¦¬ì˜¤ í…Œì´ë¸”ì€ "ì¶”ê°€ ì‹œ append", "ì‚­ì œ ì‹œ í•´ë‹¹ rowë§Œ remove"
        (ì „ì²´ innerHTML ì¬ìƒì„± ìµœì†Œí™”)
      - ì´ë²¤íŠ¸ ë°”ì¸ë”© ë°©ì‹ í†µì¼(ì¸ë¼ì¸ onclick ì œê±°)
    ====================================================================== */

    /* =========================
      0) API ì„¤ì •
    ========================= */

    const API_BASE = "https://es7hjf62t7glulxy4y2ybfck2a0hqdde.lambda-url.us-east-1.on.aws";

    const API_STATUS = {
      state: "idle",
      message: "ì—°ê²° í™•ì¸ ì „",
      meta: null,
      health: null,
      lastCheckedAt: null
    };

    async function apiGet(path, { timeoutMs = 7000 } = {}) {
      const ctrl = new AbortController();
      const t = setTimeout(() => ctrl.abort(), timeoutMs);
      try {
        const res = await fetch(`${API_BASE}${path}`, { method: "GET", signal: ctrl.signal });
        if (!res.ok) throw new Error(`GET ${path} ${res.status}`);
        return await res.json();
      } finally {
        clearTimeout(t);
      }
    }

    async function apiPost(path, bodyObj, { timeoutMs = 8000 } = {}) {
      const ctrl = new AbortController();
      const t = setTimeout(() => ctrl.abort(), timeoutMs);

      try {
        const res = await fetch(`${API_BASE}${path}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(bodyObj),
          signal: ctrl.signal
        });

        if (!res.ok) {
          let detail = "";
          try { detail = await res.text(); } catch (_) {}
          throw new Error(`POST ${path} ${res.status}${detail ? ` | ${detail.slice(0, 200)}` : ""}`);
        }

        return await res.json();
      } finally {
        clearTimeout(t);
      }
    }

    async function serverCalc(mode, inputs) {
      const res = await apiPost("/calc", { app: "pro-consulting", mode, inputs });
      if (!res?.ok) throw new Error(res?.error || "calc_failed");
      return res.result;
    }

    async function checkApiConnection() {
      API_STATUS.state = "checking";
      API_STATUS.message = "health/meta í™•ì¸ì¤‘";
      API_STATUS.lastCheckedAt = Date.now();
      renderApiStatusBadge();

      try {
        const [health, meta] = await Promise.all([ apiGet("/health"), apiGet("/meta") ]);
        API_STATUS.health = health;
        API_STATUS.meta = meta;
        API_STATUS.state = "ok";
        API_STATUS.message = "ì„œë²„ ì‘ë‹µ ì •ìƒ";
        API_STATUS.lastCheckedAt = Date.now();
      } catch (e) {
        API_STATUS.state = "error";
        API_STATUS.message = "ì„œë²„ ì—°ê²° ì‹¤íŒ¨(URL/CORS/ê²½ë¡œ í™•ì¸)";
        API_STATUS.lastCheckedAt = Date.now();
      }

      renderApiStatusBadge();
    }

    /* =========================
      1) í¬ë§·í„°(ìºì‹œ)
    ========================= */

    const NF_KRW = new Intl.NumberFormat("ko-KR", { style: "currency", currency: "KRW" });
    const NF_DEC0 = new Intl.NumberFormat("ko-KR", { style: "decimal", maximumFractionDigits: 0 });

    function formatCurrency(val) {
      return NF_KRW.format(Number(val || 0));
    }
    function formatCompactCurrency(val) {
      return NF_DEC0.format(Math.round(Number(val || 0)));
    }
    function formatRate(rate) {
      return (Number.isFinite(Number(rate)) ? Number(rate) : 0).toFixed(1);
    }
    function toPercent(num) {
      return (Number.isFinite(Number(num)) ? Number(num) : 0).toFixed(1);
    }

    /* =========================
      2) UI/ëª¨ë“œ/í•„ë“œ ì„¤ì •
    ========================= */

    const EMPTY_INPUTS = {
      annualRevenue: 0,
      monthlyExpense: 0,
      monthlyRequiredExpense: 0,
      targetProfitRate: 0,
      afterTaxNetIncome: 0
    };

    const EMPTY_RESULTS = {
      annualRev: 0, monthlyRev: 0,
      annualExp: 0, monthlyExp: 0,
      annualReqExp: 0, monthlyReqExp: 0,
      annualIncomeAmountActual: 0, annualIncomeAmountTarget: 0,
      actualProfitRate: 0, targetProfitRate: 0,
      annualNetIncome: 0, monthlyNetIncome: 0,
      annualTax: 0, monthlyTax: 0, annualTaxRate: 0,
      annualPension: 0, monthlyPension: 0,
      annualInsurance: 0, monthlyInsurance: 0
    };

    const INPUT_FIELDS = [
      { name: "annualRevenue", resultName: "annualRev" },
      { name: "monthlyExpense", resultName: "monthlyExp" },
      { name: "monthlyRequiredExpense", resultName: "monthlyReqExp" },
      { name: "targetProfitRate", resultName: "targetProfitRate" },
      { name: "afterTaxNetIncome", resultName: "monthlyNetIncome" }
    ];

    const DASHBOARD_CONFIG = {
      mode1: [
        { title:"ì˜ˆìƒ ë§¤ì¶œ", keyAnn:"annualRev", keyMon:"monthlyRev", icon:"TrendingUp", color:"bg-emerald-500" },
        { title:"ì˜ˆìƒ ì„¸í›„ìˆœì´ìµ", keyAnn:"annualNetIncome", keyMon:"monthlyNetIncome", icon:"DollarSign", color:"bg-blue-500" }
      ],
      mode2: [
        { title:"ì˜ˆìƒ ë§¤ì¶œ", keyAnn:"annualRev", keyMon:"monthlyRev", icon:"TrendingUp", color:"bg-emerald-500" },
        { title:"ëª©í‘œì†Œë“ë¥ ", keyVal:"targetProfitRate", isPercent:true, icon:"Target", color:"bg-purple-500" }
      ],
      mode3: [
        { title:"ì˜ˆìƒ ë§¤ì¶œ", keyAnn:"annualRev", keyMon:"monthlyRev", icon:"TrendingUp", color:"bg-emerald-500" },
        { title:"í•„ìš”ê²½ë¹„", keyAnn:"annualReqExp", keyMon:"monthlyReqExp", icon:"Calculator", color:"bg-orange-500" }
      ],
      mode4: [
        { title:"í•„ìš”ê²½ë¹„", keyAnn:"annualReqExp", keyMon:"monthlyReqExp", icon:"Calculator", color:"bg-orange-500" },
        { title:"ì˜ˆìƒ ì„¸í›„ìˆœì´ìµ", keyAnn:"annualNetIncome", keyMon:"monthlyNetIncome", icon:"DollarSign", color:"bg-blue-500" }
      ],
      mode5: [
        { title:"í•„ìš”ê²½ë¹„", keyAnn:"annualReqExp", keyMon:"monthlyReqExp", icon:"Calculator", color:"bg-orange-500" },
        { title:"ëª©í‘œì†Œë“ë¥ ", keyVal:"targetProfitRate", isPercent:true, icon:"Target", color:"bg-purple-500" }
      ]
    };

    const SIMULATION_MODES = [
      { id:"mode1", label:"1. ì—°ë§¤ì¶œ & ì„¸í›„ìˆœì´ìµ ì‚°ì¶œ", desc:"ì›”ì§€ì¶œ/ì›”í•„ìš”ê²½ë¹„/ëª©í‘œì†Œë“ë¥ ì„ ê¸°ë°˜ìœ¼ë¡œ ì—°ë§¤ì¶œ/ìˆœì´ìµì„ ì—­ì‚°í•©ë‹ˆë‹¤.", icon:"ğŸ“ˆ" },
      { id:"mode2", label:"2. ì—°ë§¤ì¶œ & ëª©í‘œì†Œë“ë¥  ì‚°ì¶œ", desc:"í•„ìš”ê²½ë¹„/ì§€ì¶œ/ì„¸í›„ìˆœì´ìµ ê¸°ë°˜ìœ¼ë¡œ ëª©í‘œì†Œë“ë¥ /ë§¤ì¶œì„ ì—­ì‚°í•©ë‹ˆë‹¤.", icon:"ğŸ“Š" },
      { id:"mode3", label:"3. ì—°ë§¤ì¶œ & í•„ìš”ê²½ë¹„ ì‚°ì¶œ", desc:"ì§€ì¶œ/ëª©í‘œì†Œë“ë¥ /ì„¸í›„ìˆœì´ìµ ê¸°ë°˜ìœ¼ë¡œ í•„ìš”ê²½ë¹„/ë§¤ì¶œì„ ì—­ì‚°í•©ë‹ˆë‹¤.", icon:"ğŸ§®" },
      { id:"mode4", label:"4. í•„ìš”ê²½ë¹„ & ì„¸í›„ìˆœì´ìµ ì‚°ì¶œ", desc:"ì—°ë§¤ì¶œ/ì§€ì¶œ/ëª©í‘œì†Œë“ë¥  ê¸°ë°˜ìœ¼ë¡œ í•„ìš”ê²½ë¹„/ì„¸í›„ìˆœì´ìµì„ ì‚°ì¶œí•©ë‹ˆë‹¤.", icon:"ğŸ’°" },
      { id:"mode5", label:"5. í•„ìš”ê²½ë¹„ & ëª©í‘œì†Œë“ë¥  ì‚°ì¶œ", desc:"ì—°ë§¤ì¶œ/ì§€ì¶œ/ì„¸í›„ìˆœì´ìµ ê¸°ë°˜ìœ¼ë¡œ í•„ìš”ê²½ë¹„/ëª©í‘œì†Œë“ë¥ ì„ ì—­ì‚°í•©ë‹ˆë‹¤.", icon:"ğŸ¯" }
    ];

    const ICON_MAP = {
      TrendingUp:"ğŸ“ˆ",
      PieChart:"ğŸ“Š",
      Calculator:"ğŸ§®",
      DollarSign:"ğŸ’°",
      Target:"ğŸ¯",
      FileText:"ğŸ“„"
    };

    function isInputDisabled(fieldName, mode) {
      if (mode === "mode1") return fieldName === "annualRevenue" || fieldName === "afterTaxNetIncome";
      if (mode === "mode2") return fieldName === "annualRevenue" || fieldName === "targetProfitRate";
      if (mode === "mode3") return fieldName === "annualRevenue" || fieldName === "monthlyRequiredExpense";
      if (mode === "mode4") return fieldName === "monthlyRequiredExpense" || fieldName === "afterTaxNetIncome";
      if (mode === "mode5") return fieldName === "monthlyRequiredExpense" || fieldName === "targetProfitRate";
      return false;
    }

    /* =========================
      3) ìƒíƒœ(state) ë° DOM ìºì‹œ
    ========================= */

    const state = {
      calculationMode: "mode1",
      inputs: { ...EMPTY_INPUTS },
      lastCalculatedResults: { ...EMPTY_RESULTS },
      scenarios: [],
      nextScenarioId: 1,
      dom: {
        modeSelectors: null,
        dashboardCards: null,
        dashboardInsightMode: null,
        dashboardInsightText: null,
        scenarioTableBody: null,
        addScenarioBtn: null,
        resetInputsBtn: null,
        headerResetBtn: null,
        clearScenariosBtn: null,
        excelBtn: null,
        apiStatusBadge: null,
        apiStatusSub: null,
        apiRetryBtn: null,
        inputs: {},
        inputLabels: {}
      }
    };

    /* =========================
      4) ìƒë‹¨ API ë°°ì§€ ë Œë”ë§
    ========================= */

    function renderApiStatusBadge() {
      const el = state.dom.apiStatusBadge;
      const sub = state.dom.apiStatusSub;
      if (!el || !sub) return;

      const s = API_STATUS.state;
      const msg = API_STATUS.message;

      const cls =
        s === "ok" ? "bg-emerald-50 text-emerald-700 border-emerald-200" :
        s === "checking" ? "bg-amber-50 text-amber-700 border-amber-200" :
        s === "error" ? "bg-red-50 text-red-700 border-red-200" :
        "bg-slate-50 text-slate-600 border-slate-200";

      el.className = `text-xs font-semibold px-3 py-1.5 rounded-full border ${cls} flex items-center gap-2`;
      el.innerHTML = `
        <span class="inline-block h-2 w-2 rounded-full ${
          s==="ok" ? "bg-emerald-500" :
          s==="checking" ? "bg-amber-500" :
          s==="error" ? "bg-red-500" : "bg-slate-400"
        }"></span>
        API ${s === "ok" ? "ì—°ê²°ë¨" : s === "checking" ? "í™•ì¸ì¤‘" : s === "error" ? "ì˜¤ë¥˜" : "ëŒ€ê¸°"}
      `;

      const year = API_STATUS.meta?.year ?? "-";
      const checked = API_STATUS.lastCheckedAt ? new Date(API_STATUS.lastCheckedAt).toLocaleString() : "-";
      sub.textContent = `${msg} Â· year=${year} Â· ${checked}`;
    }

    /* =========================
      5) ëŒ€ì‹œë³´ë“œ ë Œë”ë§
    ========================= */

    function createCard(title, val1, val2, isPercent, iconKey, color) {
      const icon = ICON_MAP[iconKey] || iconKey;
      const v1 = isPercent ? (Number(val1 || 0).toFixed(1) + "%") : formatCurrency(Math.round(val1 || 0));
      const v2 = isPercent ? null : formatCurrency(Math.round(val2 || 0));

      return `
        <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-200 relative overflow-hidden">
          <div class="absolute top-0 right-0 p-2 rounded-bl-xl opacity-10 ${color}">${icon}</div>
          <h4 class="text-sm font-bold text-slate-500 mb-3 flex items-center gap-2">
            <span class="text-slate-400">${icon}</span> ${title}
            <span class="text-xs font-normal text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full">ì‚°ì¶œê°’</span>
          </h4>
          <div class="space-y-3">
            <div class="flex justify-between items-end border-b border-slate-100 pb-2">
              <span class="text-xs text-slate-400">${isPercent ? "ë¹„ìœ¨" : "ì—°ê°„"}</span>
              <span class="text-lg font-bold text-slate-800">${v1}</span>
            </div>
            ${v2 ? `
              <div class="flex justify-between items-end">
                <span class="text-xs text-slate-400">ì›”ê°„</span>
                <span class="text-lg font-bold text-slate-800">${v2}</span>
              </div>
            ` : ""}
          </div>
        </div>
      `;
    }

    function createFixedResultCard(title, value1, value2) {
      if (title === "ì†Œë“ë¥ ") {
        return `
          <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-200">
            <h4 class="text-sm font-bold text-slate-500 mb-3 flex items-center gap-2">
              <span>${ICON_MAP.PieChart}</span> ${title}
            </h4>
            <div class="space-y-3">
              <div class="flex justify-between items-center border-b border-slate-100 pb-2">
                <span class="text-xs text-slate-400">ì‹¤ì œì†Œë“ë¥ </span>
                <span class="text-lg font-bold text-slate-800">${value1}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-xs text-slate-400">ëª©í‘œì†Œë“ë¥ </span>
                <span class="text-lg font-bold text-slate-800">${value2}</span>
              </div>
            </div>
          </div>
        `;
      }

      return `
        <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-200">
          <h4 class="text-sm font-bold text-slate-500 mb-3 flex items-center gap-2">
            <span class="text-slate-400">${ICON_MAP.FileText}</span> ${title}
          </h4>
          <div class="space-y-3">
            <div class="flex justify-between items-center border-b border-slate-100 pb-2">
              <span class="text-xs text-slate-400">ì—°ê°„</span>
              <span class="text-lg font-bold text-slate-800">${value1}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-xs text-slate-400">ì›”ê°„</span>
              <span class="text-lg font-bold text-slate-800">${value2}</span>
            </div>
          </div>
        </div>
      `;
    }

    function renderDashboard() {
      const res = state.lastCalculatedResults;
      const config = DASHBOARD_CONFIG[state.calculationMode] || DASHBOARD_CONFIG.mode1;

      const cardsHtml = config.map(c => {
        const annualVal = c.isPercent ? res[c.keyVal] : res[c.keyAnn];
        const monthlyVal = c.isPercent ? 0 : res[c.keyMon];
        return createCard(c.title, annualVal, monthlyVal, c.isPercent, c.icon, c.color);
      }).join("");

      const actRate = `${formatRate(res.actualProfitRate)}%`;
      const tgtRate = `${formatRate(res.targetProfitRate)}%`;

      const fixedCardsHtml = `
        ${createFixedResultCard("ì†Œë“ë¥ ", actRate, tgtRate)}
        ${createFixedResultCard("ì¢…í•©ì†Œë“ì„¸Â·ì§€ë°©ì„¸", formatCurrency(res.annualTax), formatCurrency(res.monthlyTax))}
      `;

      state.dom.dashboardCards.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">${cardsHtml}</div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">${fixedCardsHtml}</div>
      `;

      const modeLabel = SIMULATION_MODES.find(m => m.id === state.calculationMode)?.label || "";
      state.dom.dashboardInsightMode.textContent = modeLabel.split(".")[1]?.trim() || modeLabel;

      const industryAvg = 40;
      const diff = industryAvg - (res.actualProfitRate || 0);
      const diffText = diff > 0 ? "ë‚®ìŠµë‹ˆë‹¤" : "ë†’ìŠµë‹ˆë‹¤";

      state.dom.dashboardInsightText.innerHTML =
        `í˜„ì¬ ì†Œë“ë¥ (<strong>${actRate}</strong>)ì€ ë™ì¢… ì—…ê³„ í‰ê· (${industryAvg}%) ëŒ€ë¹„ <strong>${Math.abs(diff).toFixed(1)}%</strong> ${diffText}.<br/>
         í•„ìš”ê²½ë¹„ë¥¼ <strong>â‚©${formatCompactCurrency(res.monthlyReqExp)}</strong>ìœ¼ë¡œ ìœ ì§€í•  ê²½ìš°, ëª©í‘œ ì†Œë“ë¥  ë‹¬ì„±ì„ ìœ„í•´ ì—°ë§¤ì¶œ <strong>â‚©${formatCompactCurrency(res.annualRev)}</strong>ì´ í•„ìš”í•©ë‹ˆë‹¤.`;
    }

    /* =========================
      6) ì…ë ¥ í¼ ë Œë”ë§/ë™ê¸°í™”
      - disabled inputì€ "ê²°ê³¼ê°’"ì„ í‘œì‹œí•œë‹¤.
      - enabled inputì€ "ì‚¬ìš©ì ì…ë ¥ê°’"ì„ í‘œì‹œí•œë‹¤.
      - ì •ì±…ìƒ ì…ë ¥ ì¤‘ ê³„ì‚°ì´ ì—†ìœ¼ë¯€ë¡œ, enabled inputì€ ì‚¬ìš©ìê°€ ë„£ì€ ê°’ ê·¸ëŒ€ë¡œ ìœ ì§€.
    ========================= */

    function updateInputForm() {
      const mode = state.calculationMode;

      for (const f of INPUT_FIELDS) {
        const inputEl = state.dom.inputs[f.name];
        if (!inputEl) continue;

        const disabled = isInputDisabled(f.name, mode);
        inputEl.disabled = disabled;

        inputEl.className = `w-full px-4 py-2.5 rounded-lg border transition-colors ${
          disabled
            ? "bg-slate-100 border-slate-200 text-slate-400 cursor-not-allowed"
            : "bg-white border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        }`;

        inputEl.placeholder = disabled ? "ìë™ ê³„ì‚°" : "0";

        const labelSpan = state.dom.inputLabels[f.name];
        if (labelSpan) labelSpan.style.display = disabled ? "inline" : "none";

        const srcVal = disabled ? state.lastCalculatedResults[f.resultName] : state.inputs[f.name];

        if (document.activeElement !== inputEl || disabled) {
          if (f.name === "targetProfitRate") {
            inputEl.value = Number.isFinite(Number(srcVal)) ? Number(srcVal).toFixed(2) : "0.00";
          } else {
            const n = Math.round(Number(srcVal) || 0);
            inputEl.value = n ? n.toLocaleString() : "";
          }
        }
      }
    }

    /* =========================
      7) ëª¨ë“œ ì„ íƒ UI ë Œë”ë§
    ========================= */

    function renderModeSelectors() {
      state.dom.modeSelectors.innerHTML = SIMULATION_MODES.map(mode => {
        const isActive = state.calculationMode === mode.id;
        const activeClass = isActive
          ? "border-blue-600 bg-blue-50 ring-2 ring-blue-100 ring-offset-2 shadow-md"
          : "border-slate-200 bg-white hover:border-blue-300 hover:bg-blue-50/30";
        const iconClass = isActive
          ? "bg-blue-200 text-blue-700"
          : "bg-slate-100 text-slate-500 group-hover:bg-blue-100 group-hover:text-blue-600";
        const labelClass = isActive ? "text-blue-700" : "text-slate-700";
        const indicator = isActive ? '<div class="h-2 w-2 rounded-full bg-blue-600 animate-pulse mt-1"></div>' : "";

        return `
          <button class="mode-btn relative p-4 rounded-xl border-2 text-left transition-all group ${activeClass}" data-mode="${mode.id}">
            <div class="flex justify-between items-start mb-2">
              <div class="flex items-center gap-2">
                <div class="p-1.5 rounded-lg ${iconClass}">${mode.icon}</div>
                <span class="font-bold text-sm ${labelClass}">${mode.label}</span>
              </div>
              ${indicator}
            </div>
            <p class="text-xs text-slate-500 pl-9">${mode.desc}</p>
          </button>
        `;
      }).join("");
    }

    /* =========================
      8) ì‹œë‚˜ë¦¬ì˜¤ í…Œì´ë¸”
      - ì„±ëŠ¥: ì „ì²´ ì¬ë Œë” ëŒ€ì‹  append/removeë¡œ ë¶€ë¶„ ì—…ë°ì´íŠ¸
    ========================= */

    function renderScenarioEmpty() {
      state.dom.scenarioTableBody.innerHTML =
        `<tr id="scenario-empty-row">
          <td colspan="23" class="px-6 py-12 text-center text-slate-400 bg-slate-50/30">
            ì…ë ¥ í›„ ğŸ§® ê³„ì‚°í•˜ê¸°ë¥¼ ëˆŒëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.
          </td>
        </tr>`;
    }

    function scenarioRowHtml(item, idx) {
      const netRatio = item.annualRev ? ((item.annualNetIncome / item.annualRev) * 100).toFixed(1) : "0.0";
      const taxRatio = item.annualRev ? ((item.annualTax / item.annualRev) * 100).toFixed(1) : "0.0";

      return `
        <tr class="hover:bg-slate-50/80 transition-colors" id="scenario-row-${item.id}">
          <td class="px-3 py-3 text-center font-medium text-slate-400 border-r border-slate-100 sticky sticky-col sticky-col-1 bg-white z-10">${idx}</td>

          <td class="px-4 py-3 text-center border-r border-slate-100 sticky sticky-col sticky-col-2 bg-white z-10">
            <span class="px-2 py-0.5 rounded-full text-[10px] font-medium bg-slate-100 text-slate-600 truncate block w-24 mx-auto">
              ${item.mode.split(".")[0]} ì‹œë‚˜ë¦¬ì˜¤
            </span>
          </td>

          <td class="px-4 py-3 text-center text-blue-700 font-bold border-r border-slate-100">${(item.actualProfitRate||0).toFixed(1)}%</td>
          <td class="px-4 py-3 text-center text-blue-700 font-bold border-r border-slate-100">${(item.targetProfitRate||0).toFixed(1)}%</td>

          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.annualRev)}</td>
          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.monthlyRev)}</td>

          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.annualExp)}</td>
          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.monthlyExp)}</td>

          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.annualReqExp)}</td>
          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.monthlyReqExp)}</td>

          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.annualIncomeAmountActual)}</td>
          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.annualIncomeAmountTarget)}</td>

          <td class="px-2 py-3 text-right font-bold text-blue-700 border-r border-slate-100">${formatCompactCurrency(item.annualNetIncome)}</td>
          <td class="px-2 py-3 text-right font-bold text-blue-700 border-r border-slate-100">${formatCompactCurrency(item.monthlyNetIncome)}</td>
          <td class="px-2 py-3 text-center font-bold text-blue-700 border-r border-slate-100">${netRatio}%</td>

          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.annualTax)}</td>
          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.monthlyTax)}</td>
          <td class="px-2 py-3 text-center text-slate-700 border-r border-slate-100">${taxRatio}%</td>

          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.annualPension)}</td>
          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.monthlyPension)}</td>

          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.annualInsurance)}</td>
          <td class="px-2 py-3 text-right text-slate-700 border-r border-slate-100">${formatCompactCurrency(item.monthlyInsurance)}</td>

          <td class="px-3 py-3 text-center">
            <button class="remove-btn text-slate-400 hover:text-red-500 transition-colors p-1" data-id="${item.id}">ğŸ—‘ï¸</button>
          </td>
        </tr>
      `;
    }

    function appendScenarioRow(item) {
      const emptyRow = document.getElementById("scenario-empty-row");
      if (emptyRow) emptyRow.remove();

      const idx = state.scenarios.length; // append ì§ì „ lengthê°€ ê³§ í˜„ì¬ ë²ˆí˜¸
      state.dom.scenarioTableBody.insertAdjacentHTML("beforeend", scenarioRowHtml(item, idx));
    }

    function renumberScenarioRows() {
      // ì‚­ì œ í›„ ë²ˆí˜¸ë§Œ ì¬ì •ë ¬(ì²« ë²ˆì§¸ ì¹¸ë§Œ ì—…ë°ì´íŠ¸)
      // sticky col-1 ì…€ì€ ê° rowì˜ ì²« td ì´ë¯€ë¡œ, ê·¸ tdë§Œ ìˆœíšŒ ì—…ë°ì´íŠ¸
      const rows = state.dom.scenarioTableBody.querySelectorAll('tr[id^="scenario-row-"]');
      let i = 1;
      rows.forEach(row => {
        const firstTd = row.querySelector("td");
        if (firstTd) firstTd.textContent = String(i++);
      });
    }

    function removeScenarioRow(id) {
      const tr = document.getElementById(`scenario-row-${id}`);
      if (tr) tr.remove();

      if (state.scenarios.length === 0) {
        renderScenarioEmpty();
      } else {
        renumberScenarioRows();
      }
    }

    /* =========================
      9) ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
    ========================= */

    function exportScenariosToExcel() {
      if (!window.XLSX || !state.scenarios.length) {
        alert("ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤.");
        return;
      }

      const header = [
        "No","êµ¬ë¶„(ëª¨ë“œ)",
        "ì‹¤ì œì†Œë“ë¥ (%)","ëª©í‘œì†Œë“ë¥ (%)",
        "ì—°ë§¤ì¶œ","ì›”ë§¤ì¶œ",
        "ì—°ì§€ì¶œ","ì›”ì§€ì¶œ",
        "ì—°í•„ìš”ê²½ë¹„","ì›”í•„ìš”ê²½ë¹„",
        "ì†Œë“ê¸ˆì•¡(ì‹¤ì œ)","ì†Œë“ê¸ˆì•¡(ëª©í‘œ)",
        "ì—°ì„¸í›„ìˆœì´ìµ","ì›”ì„¸í›„ìˆœì´ìµ","ì„¸í›„ìˆœì´ìµë¹„ìœ¨(%)",
        "ì—°ì¢…í•©ì†Œë“ì„¸Â·ì§€ë°©ì„¸","ì›”ì¢…í•©ì†Œë“ì„¸Â·ì§€ë°©ì„¸","ì„¸ê¸ˆë¹„ìœ¨(ì—°ë§¤ì¶œëŒ€ë¹„, %)",
        "ì—°êµ­ë¯¼ì—°ê¸ˆ","ì›”êµ­ë¯¼ì—°ê¸ˆ",
        "ì—°ê±´ê°•ë³´í—˜ë£Œ(ê±´ë³´+ì¥ê¸°ìš”ì–‘)","ì›”ê±´ê°•ë³´í—˜ë£Œ(ê±´ë³´+ì¥ê¸°ìš”ì–‘)"
      ];

      const rows = state.scenarios.map((s, i) => {
        const netRatio = s.annualRev ? ((s.annualNetIncome / s.annualRev) * 100) : 0;
        const taxRatio = s.annualRev ? ((s.annualTax / s.annualRev) * 100) : 0;

        return [
          i + 1,
          s.mode,
          Number(formatRate(s.actualProfitRate)),
          Number(formatRate(s.targetProfitRate)),
          Math.round(s.annualRev), Math.round(s.monthlyRev),
          Math.round(s.annualExp), Math.round(s.monthlyExp),
          Math.round(s.annualReqExp), Math.round(s.monthlyReqExp),
          Math.round(s.annualIncomeAmountActual), Math.round(s.annualIncomeAmountTarget),
          Math.round(s.annualNetIncome), Math.round(s.monthlyNetIncome),
          Number(toPercent(netRatio)),
          Math.round(s.annualTax), Math.round(s.monthlyTax),
          Number(toPercent(taxRatio)),
          Math.round(s.annualPension), Math.round(s.monthlyPension),
          Math.round(s.annualInsurance), Math.round(s.monthlyInsurance)
        ];
      });

      const ws = XLSX.utils.aoa_to_sheet([header, ...rows]);
      ws["!cols"] = [
        { wch: 5 }, { wch: 24 },
        { wch: 14 }, { wch: 14 },
        { wch: 14 }, { wch: 14 },
        { wch: 14 }, { wch: 14 },
        { wch: 14 }, { wch: 14 },
        { wch: 16 }, { wch: 16 },
        { wch: 16 }, { wch: 16 }, { wch: 18 },
        { wch: 20 }, { wch: 20 }, { wch: 22 },
        { wch: 14 }, { wch: 14 },
        { wch: 22 }, { wch: 22 }
      ];

      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Scenarios");

      const now = new Date();
      const filename = `Pro-Consulting-Scenarios_${now.getFullYear()}${String(now.getMonth()+1).padStart(2,"0")}${String(now.getDate()).padStart(2,"0")}.xlsx`;
      XLSX.writeFile(wb, filename);
    }

    /* =========================
      10) ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
    ========================= */

    function setCalculationMode(modeId) {
      state.calculationMode = modeId;
      renderModeSelectors();
      updateInputForm();
      renderDashboard();
    }

    function handleInput(e) {
      const el = e.target;
      const name = el.name;
      if (!name) return;

      if (isInputDisabled(name, state.calculationMode)) return;

      const type = el.type;
      const isMoneyText = (type === "text" && ["annualRevenue","monthlyExpense","monthlyRequiredExpense","afterTaxNetIncome"].includes(name));
      const isNumber = (type === "number" || name === "targetProfitRate");

      if (!isMoneyText && !isNumber) return;

      let rawValue = 0;
      if (isMoneyText) rawValue = Number(String(el.value).replace(/,/g, ""));
      else rawValue = Number(el.value);

      if (Number.isNaN(rawValue)) return;

      state.inputs[name] = rawValue;

      // ì…ë ¥ UX: ê¸°ì¡´ ë™ì‘ ìœ ì§€(ì…ë ¥ ì‹œ ì½¤ë§ˆ ë°˜ì˜) â€” ì»¤ì„œ íŠì´ ë¶ˆí¸í•˜ë©´ blur í¬ë§·ìœ¼ë¡œ ë°”ê¾¸ëŠ” ê²Œ ë” ì¢‹ìŒ
      if (isMoneyText) el.value = rawValue ? rawValue.toLocaleString() : "";
    }

    async function handleAddScenario() {
      try {
        const result = await serverCalc(state.calculationMode, state.inputs);

        state.lastCalculatedResults = result;

        const modeLabel = SIMULATION_MODES.find(m => m.id === state.calculationMode)?.label || "";
        const newScenario = { id: state.nextScenarioId++, mode: modeLabel, ...result };

        state.scenarios.push(newScenario);

        updateInputForm();
        renderDashboard();
        appendScenarioRow(newScenario);

      } catch (e) {
        alert("ê³„ì‚° ì‹¤íŒ¨: ì„œë²„ ì‘ë‹µì„ í™•ì¸í•˜ì„¸ìš”.");
        API_STATUS.state = "error";
        API_STATUS.message = "ê³„ì‚° ì‹¤íŒ¨(ì„œë²„ ì‘ë‹µ í™•ì¸)";
        API_STATUS.lastCheckedAt = Date.now();
        renderApiStatusBadge();
      }
    }

    function handleRemoveScenario(id) {
      state.scenarios = state.scenarios.filter(s => s.id !== id);
      removeScenarioRow(id);
    }

    function handleClearScenarios() {
      state.scenarios = [];
      state.dom.scenarioTableBody.innerHTML = "";
      renderScenarioEmpty();
    }

    function handleResetAll() {
      state.inputs = { ...EMPTY_INPUTS };
      state.lastCalculatedResults = { ...EMPTY_RESULTS };
      state.scenarios = [];
      state.nextScenarioId = 1;

      updateInputForm();
      renderDashboard();

      state.dom.scenarioTableBody.innerHTML = "";
      renderScenarioEmpty();
    }

    /* =========================
      11) ì´ˆê¸°í™”(onload)
    ========================= */

    window.addEventListener("load", () => {
      state.dom.modeSelectors = document.getElementById("mode-selectors");
      state.dom.dashboardCards = document.getElementById("dashboard-cards");
      state.dom.dashboardInsightMode = document.getElementById("dashboard-insight-mode");
      state.dom.dashboardInsightText = document.getElementById("dashboard-insight-text");
      state.dom.scenarioTableBody = document.getElementById("scenario-table-body");

      state.dom.addScenarioBtn = document.getElementById("add-scenario-btn");
      state.dom.resetInputsBtn = document.getElementById("reset-inputs-btn");
      state.dom.headerResetBtn = document.getElementById("header-reset-btn");
      state.dom.clearScenariosBtn = document.getElementById("clear-scenarios-btn");
      state.dom.excelBtn = document.getElementById("excel-download-btn");

      state.dom.apiStatusBadge = document.getElementById("api-status-badge");
      state.dom.apiStatusSub = document.getElementById("api-status-sub");
      state.dom.apiRetryBtn = document.getElementById("api-retry-btn");

      // ì…ë ¥ ìš”ì†Œ ë° "ìë™ ì‚°ì¶œë¨" ë¼ë²¨ span ìºì‹±
      INPUT_FIELDS.forEach(f => {
        const inputEl = document.querySelector(`[name="${f.name}"]`);
        state.dom.inputs[f.name] = inputEl;

        // í•´ë‹¹ inputì´ ì†í•œ labelì˜ span(ìë™ ì‚°ì¶œë¨)ì„ ì°¾ì•„ ìºì‹±
        // êµ¬ì¡°ê°€ ë°”ë€Œë”ë¼ë„ label ë‚´ spanë§Œ ìœ ì§€ë˜ë©´ ë™ì‘í•˜ë„ë¡ ë²”ìœ„ë¥¼ ìµœì†Œí™”
        const wrapper = inputEl?.closest("div");
        const labelSpan = wrapper?.querySelector("label span");
        if (labelSpan) state.dom.inputLabels[f.name] = labelSpan;

        if (inputEl) inputEl.addEventListener("input", handleInput);
      });

      // ë²„íŠ¼ ì´ë²¤íŠ¸
      state.dom.addScenarioBtn?.addEventListener("click", handleAddScenario);

      // ì´ˆê¸°í™” ë²„íŠ¼(ë‘ ê³³) ëª¨ë‘: ì…ë ¥+ëŒ€ì‹œë³´ë“œ+ì‹œë‚˜ë¦¬ì˜¤ ì „ì²´ ì´ˆê¸°í™”
      state.dom.resetInputsBtn?.addEventListener("click", handleResetAll);
      state.dom.headerResetBtn?.addEventListener("click", handleResetAll);

      state.dom.clearScenariosBtn?.addEventListener("click", handleClearScenarios);
      state.dom.excelBtn?.addEventListener("click", exportScenariosToExcel);
      state.dom.apiRetryBtn?.addEventListener("click", checkApiConnection);

      // ëª¨ë“œ ì„ íƒ + ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ ë²„íŠ¼ì€ ì´ë²¤íŠ¸ ìœ„ì„
      document.addEventListener("click", (e) => {
        const modeBtn = e.target.closest(".mode-btn");
        if (modeBtn) {
          const modeId = modeBtn.getAttribute("data-mode");
          if (modeId) setCalculationMode(modeId);
          return;
        }

        const removeBtn = e.target.closest(".remove-btn");
        if (removeBtn) {
          const id = Number(removeBtn.getAttribute("data-id"));
          if (Number.isFinite(id)) handleRemoveScenario(id);
        }
      });

      // ìµœì´ˆ ë Œë”(ëŒ€ì‹œë³´ë“œ 0ê°’ ìœ ì§€)
      renderModeSelectors();
      updateInputForm();
      renderDashboard();
      renderScenarioEmpty();
      checkApiConnection();
    });
  </script>
</head>

<body class="min-h-screen bg-slate-50 font-sans text-slate-900">
  <div id="app-root">
    <header class="bg-white border-b border-slate-200 sticky top-0 z-30">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="bg-blue-600 p-2 rounded-lg">ğŸ§®</div>
          <div>
            <h1 class="text-xl font-bold text-slate-800 tracking-tight">Pro-Consulting Lab</h1>
            <p id="api-status-sub" class="text-[11px] text-slate-500 mt-0.5">ì—°ê²° í™•ì¸ ì „</p>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <div id="api-status-badge" class="text-xs font-semibold px-3 py-1.5 rounded-full border bg-slate-50 text-slate-600 border-slate-200 flex items-center gap-2">
            <span class="inline-block h-2 w-2 rounded-full bg-slate-400"></span> API ëŒ€ê¸°
          </div>

          <button id="api-retry-btn" class="text-xs font-medium bg-white border border-slate-300 px-3 py-1.5 rounded-lg hover:bg-slate-50 transition-colors">
            ğŸ”Œ API ì¬í™•ì¸
          </button>

          <button id="header-reset-btn" class="text-sm text-slate-500 hover:text-slate-800 px-3 py-2 flex items-center gap-1 transition-colors rounded-lg">
            ğŸ”„ ì´ˆê¸°í™”
          </button>
        </div>
      </div>
    </header>

    <main class="max-w-[1800px] mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <section class="mb-8">
        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">ğŸ’¡ ì‹œë®¬ë ˆì´ì…˜ ê¸°ì¤€ ì„¤ì •</h2>
        <div id="mode-selectors" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4"></div>
      </section>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-10">
        <div class="lg:col-span-1 bg-white rounded-2xl shadow-xl border border-slate-200 p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="font-bold text-lg text-slate-800">ê¸°ì´ˆ ë°ì´í„° ì…ë ¥</h3>
            <span class="text-xs font-medium px-2 py-1 bg-slate-100 rounded text-slate-500">ë‹¨ìœ„: ì›</span>
          </div>

          <div class="space-y-5" id="input-form">
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-1.5 flex justify-between">ì—°ë§¤ì¶œ
                <span style="display:none;" class="text-xs text-blue-500 font-normal self-center">ìë™ ì‚°ì¶œë¨</span>
              </label>
              <input type="text" name="annualRevenue" class="w-full px-4 py-2.5 rounded-lg border transition-colors" />
            </div>

            <div>
              <label class="block text-sm font-medium text-slate-700 mb-1.5">ì›”ì§€ì¶œ</label>
              <input type="text" name="monthlyExpense" class="w-full px-4 py-2.5 rounded-lg border transition-colors" />
            </div>

            <div>
              <label class="block text-sm font-medium text-slate-700 mb-1.5 flex justify-between">ì›”í•„ìš”ê²½ë¹„
                <span style="display:none;" class="text-xs text-blue-500 font-normal self-center">ìë™ ì‚°ì¶œë¨</span>
              </label>
              <input type="text" name="monthlyRequiredExpense" class="w-full px-4 py-2.5 rounded-lg border transition-colors" />
            </div>

            <div>
              <label class="block text-sm font-medium text-slate-700 mb-1.5 flex justify-between">ëª©í‘œì†Œë“ë¥  (%)
                <span style="display:none;" class="text-xs text-blue-500 font-normal self-center">ìë™ ì‚°ì¶œë¨</span>
              </label>
              <div class="relative">
                <input type="number" name="targetProfitRate" step="0.1" class="w-full px-4 py-2.5 rounded-lg border transition-colors pr-8" />
                <span class="absolute right-3 top-2.5 text-slate-400">%</span>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-slate-700 mb-1.5 flex justify-between">ì„¸í›„ì›”ìˆœì´ìµ
                <span style="display:none;" class="text-xs text-blue-500 font-normal self-center">ìë™ ì‚°ì¶œë¨</span>
              </label>
              <input type="text" name="afterTaxNetIncome" class="w-full px-4 py-2.5 rounded-lg border transition-colors" />
            </div>

            <div class="grid grid-cols-2 gap-3 mt-8 pt-4 border-t border-slate-100">
              <button id="add-scenario-btn" class="bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-semibold shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2 transform hover:scale-[1.02] active:scale-100">ğŸ§® ê³„ì‚°í•˜ê¸°</button>
              <button id="reset-inputs-btn" class="bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 py-3 rounded-xl font-semibold transition-all flex items-center justify-center gap-2">ğŸ”„ ì…ë ¥ ì´ˆê¸°í™”</button>
            </div>
          </div>
        </div>

        <div class="lg:col-span-2 space-y-6">
          <h3 class="font-bold text-lg text-slate-800 mb-4 flex items-center gap-2">â¡ï¸ ì‹¤ì‹œê°„ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h3>
          <div id="dashboard-cards" class="space-y-4"></div>

          <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 flex items-start gap-3">
            <div class="p-1 bg-amber-100 rounded text-amber-600 mt-1">ğŸ“ˆ</div>
            <div>
              <h4 class="text-sm font-bold text-amber-800">ì»¨ì„¤íŒ… ì¸ì‚¬ì´íŠ¸ (<span id="dashboard-insight-mode"></span>)</h4>
              <p class="text-sm text-amber-700 mt-1 leading-relaxed" id="dashboard-insight-text"></p>
            </div>
          </div>

          <div class="bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm text-slate-600">
            <div class="font-semibold text-slate-700 mb-1">ê³„ì‚°ë°©ì‹</div>
            <ul class="list-disc ml-5 space-y-1 text-[13px]">
              <li>ëª©í‘œì†Œë“ë¥ ì´ 0%ì´í•˜ì¸ ê²½ìš° â†’ 0% í‘œê¸°</li>
              <li>êµ­ë¯¼ì—°ê¸ˆ ë° ê±´ê°•ë³´í—˜ë£ŒëŠ” ëª©í‘œì†Œë“ì„ ê¸°ì¤€ìœ¼ë¡œ ë„ì¶œë¨</span></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden">
        <div class="p-5 border-b border-slate-200 flex justify-between items-center bg-slate-50/50">
          <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">ğŸ“„ ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ ë¶„ì„</h3>
          <div class="flex gap-2">
            <button id="excel-download-btn" class="text-xs font-medium bg-white border border-slate-300 px-3 py-1.5 rounded-lg hover:bg-slate-50 transition-colors">Excel ë‹¤ìš´ë¡œë“œ</button>
            <button id="clear-scenarios-btn" class="text-xs font-medium bg-white border border-slate-300 px-3 py-1.5 rounded-lg hover:bg-red-50 transition-colors text-red-500 border-red-200">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
          </div>
        </div>

        <div class="table-container">
          <table class="w-full text-xs text-left border-collapse">
            <thead class="bg-slate-50 text-slate-600 font-semibold border-b border-slate-200 sticky top-0 z-20">
              <tr>
                <th rowspan="2" class="px-3 py-4 whitespace-nowrap text-center border-r border-slate-200 sticky sticky-col sticky-col-1 bg-slate-50 z-20">No</th>
                <th rowspan="2" class="px-4 py-4 whitespace-nowrap text-center border-r border-slate-200 sticky sticky-col sticky-col-2 bg-slate-50 z-20">êµ¬ë¶„</th>
                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200 bg-blue-50 text-blue-800">ì†Œë“ë¥ </th>
                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200 bg-slate-50 text-slate-800">ë§¤ì¶œ</th>
                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200 bg-slate-50 text-slate-800">ì§€ì¶œ</th>
                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200 bg-slate-50 text-slate-800">í•„ìš”ê²½ë¹„</th>
                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200 bg-slate-50 text-slate-800">ì†Œë“ê¸ˆì•¡</th>
                <th colspan="3" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200 bg-blue-50 text-blue-800">ì„¸í›„ìˆœì´ìµ</th>
                <th colspan="3" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200">ì¢…í•©ì†Œë“ì„¸<span class="text-[9px] text-slate-400 align-middle">(ì§€ë°©ì„¸í¬í•¨)</span></th>
                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200">êµ­ë¯¼ì—°ê¸ˆ</th>
                <th colspan="2" class="px-2 py-2 whitespace-nowrap text-center border-r border-slate-200">ê±´ê°•ë³´í—˜ë£Œ<span class="text-[9px] text-slate-400 align-middle">(ì¥ê¸°ìš”ì–‘í¬í•¨)</span></th>
                <th rowspan="2" class="px-3 py-4 text-center">ê´€ë¦¬</th>
              </tr>
              <tr class="bg-slate-50/50 text-[11px] text-slate-500">
                <th class="px-4 py-2 text-center border-r border-slate-200 bg-blue-100/50 text-blue-800">ì‹¤ì œ</th>
                <th class="px-4 py-2 text-center border-r border-slate-200 bg-blue-100/50 text-blue-800">ëª©í‘œ</th>

                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì—°ê°„</th>
                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì›”ê°„</th>

                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì—°ê°„</th>
                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì›”ê°„</th>

                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì—°ê°„</th>
                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì›”ê°„</th>

                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì‹¤ì œ</th>
                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ëª©í‘œ</th>

                <th class="px-2 py-2 text-center border-r border-slate-200 bg-blue-100/50 text-blue-800">ì—°ê°„</th>
                <th class="px-2 py-2 text-center border-r border-slate-200 bg-blue-100/50 text-blue-800">ì›”ê°„</th>
                <th class="px-2 py-2 text-center border-r border-slate-200 bg-blue-100/50 text-blue-800">ë¹„ìœ¨</th>

                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì—°ê°„</th>
                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì›”ê°„</th>
                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ë¹„ìœ¨</th>

                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì—°ê°„</th>
                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì›”ê°„</th>

                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì—°ê°„</th>
                <th class="px-2 py-2 text-center border-r border-slate-200 bg-slate-100/50 text-slate-800">ì›”ê°„</th>
              </tr>
            </thead>
            <tbody id="scenario-table-body" class="divide-y divide-slate-100"></tbody>
          </table>
        </div>
      </div>
    </main>
  </div>
</body>
</html>
